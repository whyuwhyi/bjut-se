# å¾®ä¿¡å°ç¨‹åºæ•™è‚²èµ„æºå¹³å°æ•°æ®åº“è®¾è®¡æ–‡æ¡£

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†å¾®ä¿¡å°ç¨‹åºæ•™è‚²èµ„æºå¹³å°çš„æ•°æ®åº“è®¾è®¡ï¼ŒåŒ…å«ç”¨æˆ·ç®¡ç†ã€èµ„æºå…±äº«ã€å­¦ä¹ ç®¡ç†ã€è®¨è®ºäº¤æµã€é€šçŸ¥ç³»ç»Ÿã€ä¸¾æŠ¥ç®¡ç†ã€ç”¨æˆ·åé¦ˆç­‰æ ¸å¿ƒåŠŸèƒ½æ¨¡å—çš„å®Œæ•´æ•°æ®åº“è¡¨ç»“æ„è®¾è®¡ã€‚

### æ•°æ®åº“è¡¨ç»“æ„æ€»è§ˆ

| æ¨¡å—åˆ†ç±» | è¡¨å | åŠŸèƒ½æè¿° | è®°å½•æ•°é‡ï¼ˆç¤ºä¾‹ï¼‰ |
|---------|------|----------|-----------------|
| **æ ¸å¿ƒä¸šåŠ¡** | users | ç”¨æˆ·åŸºç¡€ä¿¡æ¯å’Œè®¤è¯ | 3 |
| **èµ„æºç®¡ç†** | categories | èµ„æºåˆ†ç±»ç®¡ç† | 2 |
| | resources | å­¦ä¹ èµ„æºæ ¸å¿ƒä¿¡æ¯ | 3 |
| | files | èµ„æºå…³è”æ–‡ä»¶ | 3 |
| | tags | èµ„æºæ ‡ç­¾ä½“ç³» | åŠ¨æ€ |
| | resource_tags | èµ„æºæ ‡ç­¾å…³è” | åŠ¨æ€ |
| **è®ºå›äº¤æµ** | posts | è®ºå›å¸–å­å†…å®¹ | 3 |
| | post_tags | å¸–å­æ ‡ç­¾ç®¡ç† | 3 |
| | post_tag_relations | å¸–å­æ ‡ç­¾å…³è” | 4 |
| | comments | è¯„è®ºå›å¤ç³»ç»Ÿ | 6 |
| | ratings | èµ„æºè¯„åˆ†è®°å½• | 3 |
| **å­¦ä¹ ç®¡ç†** | study_plans | å­¦ä¹ è®¡åˆ’ç®¡ç† | 2 |
| | study_tasks | å­¦ä¹ ä»»åŠ¡ç®¡ç† | 3 |
| | sub_tasks | å­ä»»åŠ¡ç»†åŒ–ç®¡ç† | 10 |
| **ç”¨æˆ·äº¤äº’** | user_follows | ç”¨æˆ·å…³æ³¨å…³ç³» | 2 |
| | collections | å¤šç±»å‹æ”¶è—ç®¡ç† | 5 |
| **é€šçŸ¥ç³»ç»Ÿ** | notifications | ç»Ÿä¸€æ¶ˆæ¯é€šçŸ¥ | 2 |
| **ä¸¾æŠ¥ç®¡ç†** | resource_reports | èµ„æºä¸¾æŠ¥å¤„ç† | 2 |
| | post_reports | å¸–å­ä¸¾æŠ¥å¤„ç† | 1 |
| **ç”¨æˆ·åé¦ˆ** | feedbacks | ç”¨æˆ·åé¦ˆå»ºè®® | åŠ¨æ€ |
| **ç³»ç»Ÿè¾…åŠ©** | verification_codes | éªŒè¯ç ç®¡ç† | ä¸´æ—¶ |

### æ ¸å¿ƒç‰¹æ€§

- **å±‚çº§åŒ–å­¦ä¹ ç®¡ç†**: è®¡åˆ’â†’ä»»åŠ¡â†’å­ä»»åŠ¡ä¸‰çº§ç®¡ç†ä½“ç³»ï¼Œæ”¯æŒæ—¶é—´çº¦æŸéªŒè¯
- **å®Œæ•´çš„å†…å®¹æ²»ç†**: ä¸¾æŠ¥ç³»ç»Ÿ+å®¡æ ¸æµç¨‹+ç®¡ç†å‘˜å¤„ç†æœºåˆ¶
- **å¤šç»´åº¦ç”¨æˆ·äº¤äº’**: å…³æ³¨ã€æ”¶è—ã€è¯„è®ºã€è¯„åˆ†ç­‰ç¤¾äº¤åŠŸèƒ½
- **æ™ºèƒ½é€šçŸ¥ç³»ç»Ÿ**: åˆ†ç±»é€šçŸ¥+ä¼˜å…ˆçº§ç®¡ç†+è¿‡æœŸæ¸…ç†
- **çµæ´»çš„åˆ†ç±»ä½“ç³»**: æ”¯æŒèµ„æºåˆ†ç±»å’Œå¸–å­æ ‡ç­¾çš„åŠ¨æ€ç®¡ç†

---

## 1. æ ¸å¿ƒä¸šåŠ¡è¡¨

### 1.1 ç”¨æˆ·è¡¨ (users)

ç”¨æˆ·ç³»ç»Ÿçš„æ ¸å¿ƒè¡¨ï¼Œå­˜å‚¨æ‰€æœ‰ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯å’Œè®¤è¯æ•°æ®ã€‚

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸæ¡ä»¶ | æè¿° |
|--------|----------|----------|------|
| phone_number | VARCHAR(11) | PRIMARY KEY | 11ä½æ‰‹æœºå·ï¼Œä»¥1å¼€å¤´ï¼ˆä¸»é”®ï¼‰ |
| student_id | VARCHAR(20) | UNIQUE | å­¦å·ï¼š8ä½æ•°å­—æˆ–S+9ä½æ•°å­—ï¼ˆå¯ç©ºï¼‰ |
| password | VARCHAR(255) | NOT NULL | åŠ å¯†åçš„å¯†ç  |
| name | VARCHAR(50) | NOT NULL | çœŸå®å§“åï¼Œ1-50ä¸ªå­—ç¬¦ |
| nickname | VARCHAR(50) | | æ˜µç§° |
| avatar_url | VARCHAR(500) | | å¤´åƒURL |
| email | VARCHAR(100) | | é‚®ç®±åœ°å€ |
| bio | TEXT | | ä¸ªäººç®€ä»‹ |
| gender | ENUM('M','F','U') | DEFAULT 'U' | æ€§åˆ«ï¼šM-ç”·ï¼ŒF-å¥³ï¼ŒU-æœªçŸ¥ |
| role | ENUM('user','admin') | DEFAULT 'user' | ç”¨æˆ·è§’è‰²ï¼šuser-æ™®é€šç”¨æˆ·ï¼Œadmin-ç®¡ç†å‘˜ |
| status | ENUM('active','inactive','banned') | DEFAULT 'active' | ç”¨æˆ·çŠ¶æ€ |
| post_count | INT | DEFAULT 0 | å‘è¡¨çš„å¸–å­æ•°é‡ |
| resource_count | INT | DEFAULT 0 | ä¸Šä¼ çš„èµ„æºæ•°é‡ |
| follower_count | INT | DEFAULT 0 | ç²‰ä¸æ•°é‡ |
| following_count | INT | DEFAULT 0 | å…³æ³¨æ•°é‡ |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**æƒé™è¯´æ˜**:
- **user (æ™®é€šç”¨æˆ·)**: å¯ä»¥æ³¨å†Œã€ç™»å½•ã€å‘å¸ƒèµ„æºã€å‚ä¸è®ºå›è®¨è®ºç­‰åŸºç¡€åŠŸèƒ½
- **admin (ç®¡ç†å‘˜)**: å…·å¤‡æ‰€æœ‰æ™®é€šç”¨æˆ·æƒé™ï¼ŒåŒæ—¶å¯ä»¥å®¡æ ¸èµ„æºã€ç®¡ç†ç”¨æˆ·ã€å‘å¸ƒç³»ç»Ÿé€šçŸ¥ã€æŸ¥çœ‹ç»Ÿè®¡æ•°æ®ç­‰ç®¡ç†åŠŸèƒ½

**ä¸šåŠ¡è§„åˆ™**:
- é»˜è®¤æ³¨å†Œç”¨æˆ·è§’è‰²ä¸º 'user'
- ç®¡ç†å‘˜è´¦å·éœ€è¦æ‰‹åŠ¨è®¾ç½®æˆ–é€šè¿‡æ•°æ®åº“åˆå§‹åŒ–
- ç®¡ç†å‘˜æƒé™éªŒè¯é€šè¿‡åç«¯ä¸­é—´ä»¶å®ç°
- æ”¯æŒåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC)

---

## 2. èµ„æºç®¡ç†æ¨¡å—

### 2.1 èµ„æºåˆ†ç±»è¡¨ (categories)

æ”¯æŒèµ„æºåˆ†ç±»ç®¡ç†ï¼Œåˆ†ç±»å¯é€šè¿‡ç®¡ç†åå°åŠ¨æ€ç®¡ç†ã€‚èµ„æºåˆ†ç±»æ˜¯æ•´ä¸ªèµ„æºç³»ç»Ÿçš„æ ¸å¿ƒç»„ç»‡æ–¹å¼ï¼Œæä¾›çµæ´»çš„åˆ†ç±»ä½“ç³»æ”¯æŒã€‚

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸæ¡ä»¶ | æè¿° |
|--------|----------|----------|------|
| category_id | VARCHAR(20) | PRIMARY KEY | åˆ†ç±»å”¯ä¸€æ ‡è¯†ç¬¦ |
| category_name | VARCHAR(50) | UNIQUE, NOT NULL | åˆ†ç±»åç§°ï¼Œ1-50ä¸ªå­—ç¬¦ |
| category_value | VARCHAR(50) | UNIQUE, NOT NULL | åˆ†ç±»å€¼ï¼ˆç”¨äºAPIå‚æ•°ï¼‰ |
| description | TEXT | | åˆ†ç±»æè¿° |
| icon | VARCHAR(10) | | åˆ†ç±»å›¾æ ‡ï¼ˆæ”¯æŒemojiï¼‰ |
| sort_order | INT | NOT NULL, DEFAULT 0 | æ’åºé¡ºåº |
| status | ENUM('active','inactive') | NOT NULL, DEFAULT 'active' | çŠ¶æ€ï¼šactive-å¯ç”¨ï¼Œinactive-ç¦ç”¨ |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**åˆ†ç±»ç³»ç»Ÿç‰¹ç‚¹ï¼š**
- **åŒé‡æ ‡è¯†**: æ—¢æœ‰ç”¨æˆ·å‹å¥½çš„åˆ†ç±»åç§°ï¼Œä¹Ÿæœ‰ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨çš„åˆ†ç±»å€¼
- **å›¾æ ‡æ”¯æŒ**: æ”¯æŒemojiå›¾æ ‡ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- **çµæ´»æ’åº**: é€šè¿‡sort_orderå­—æ®µæ”¯æŒè‡ªå®šä¹‰æ’åº
- **çŠ¶æ€ç®¡ç†**: æ”¯æŒå¯ç”¨/ç¦ç”¨åˆ†ç±»ï¼Œä¾¿äºåŠ¨æ€è°ƒæ•´
- **ç®¡ç†ç•Œé¢**: åˆ†ç±»å¯é€šè¿‡ç®¡ç†åå°è¿›è¡Œåˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤å’Œæ’åº

**é¢„è®¾åˆ†ç±»ç¤ºä¾‹ï¼š**
- ç¼–ç¨‹å¼€å‘ (programming) ğŸ“š
- è®¾è®¡ç´ æ (design) ğŸ¨  
- å­¦æœ¯è®ºæ–‡ (academic) ğŸ“–
- å·¥å…·è½¯ä»¶ (tools) ğŸ› ï¸
- å…¶ä»–èµ„æº (others) ğŸ“¦

### 2.2 èµ„æºè¡¨ (resources)

å­˜å‚¨æ‰€æœ‰å­¦ä¹ èµ„æºçš„æ ¸å¿ƒä¿¡æ¯å’Œç»Ÿè®¡æ•°æ®ã€‚

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸæ¡ä»¶ | æè¿° |
|--------|----------|----------|------|
| resource_id | VARCHAR(9) | PRIMARY KEY | 9ä½æ•°å­—çš„èµ„æºå”¯ä¸€æ ‡è¯†ç¬¦ |
| publisher_phone | VARCHAR(11) | FOREIGN KEY, NOT NULL | å‘å¸ƒè€…æ‰‹æœºå·ï¼ˆå¤–é”®åˆ°ç”¨æˆ·è¡¨ï¼‰ |
| resource_name | VARCHAR(100) | NOT NULL | èµ„æºåç§° |
| description | TEXT | | èµ„æºæè¿° |
| collection_count | INT | DEFAULT 0 | èµ„æºæ”¶è—æ¬¡æ•°ï¼Œ0-999999999 |
| comment_count | INT | DEFAULT 0 | èµ„æºè¯„è®ºæ•°é‡ï¼Œ0-999999999 |
| rating | DECIMAL(4,2) | DEFAULT 0.00 | èµ„æºè¯„åˆ†ï¼Œ1-5åˆ† |
| view_count | INT | DEFAULT 0 | æµè§ˆæ¬¡æ•° |
| status | ENUM('draft','pending','published','rejected','archived') | DEFAULT 'draft' | èµ„æºçŠ¶æ€ï¼šdraft-è‰ç¨¿ï¼Œpending-å¾…å®¡æ ¸ï¼Œpublished-å·²å‘å¸ƒï¼Œrejected-å·²æ‹’ç»ï¼Œarchived-å·²å½’æ¡£ |
| reviewer_phone | VARCHAR(11) | FOREIGN KEY | å®¡æ ¸è€…æ‰‹æœºå·ï¼ˆå¤–é”®åˆ°ç”¨æˆ·è¡¨ï¼‰ |
| review_comment | TEXT | | å®¡æ ¸æ„è§ |
| reviewed_at | DATETIME | | å®¡æ ¸æ—¶é—´ |
| download_count | INT | DEFAULT 0 | ä¸‹è½½æ¬¡æ•° |
| report_count | INT | DEFAULT 0 | ä¸¾æŠ¥æ¬¡æ•° |
| category_id | VARCHAR(20) | FOREIGN KEY | èµ„æºåˆ†ç±»IDï¼ˆå¤–é”®åˆ°categoriesè¡¨ï¼‰ |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**èµ„æºå®¡æ ¸å·¥ä½œæµï¼š**
- **draft**: è‰ç¨¿çŠ¶æ€ï¼Œç”¨æˆ·ç¼–è¾‘ä¸­
- **pending**: æäº¤å®¡æ ¸ï¼Œç­‰å¾…ç®¡ç†å‘˜å¤„ç†
- **published**: å®¡æ ¸é€šè¿‡ï¼Œå…¬å¼€å±•ç¤º
- **rejected**: å®¡æ ¸æ‹’ç»ï¼Œéœ€è¦ä¿®æ”¹
- **archived**: å·²å½’æ¡£ï¼Œä¸å†å±•ç¤º

**åˆ†ç±»å…³è”ï¼š**
- é€šè¿‡ `category_id` å­—æ®µå…³è”åˆ° `categories` è¡¨
- æ”¯æŒåˆ†ç±»ç­›é€‰å’Œç»Ÿè®¡åŠŸèƒ½
- å½“åˆ†ç±»è¢«åˆ é™¤æ—¶ï¼Œç›¸å…³èµ„æºçš„category_idè®¾ä¸ºNULL


### 2.3 æ–‡ä»¶è¡¨ (files)

å­˜å‚¨èµ„æºå…³è”çš„æ–‡ä»¶ä¿¡æ¯ï¼Œæ”¯æŒå¤šç§å­˜å‚¨æ–¹å¼ã€‚

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸæ¡ä»¶ | æè¿° |
|--------|----------|----------|------|
| file_id | VARCHAR(9) | PRIMARY KEY | 9ä½æ•°å­—çš„æ–‡ä»¶å”¯ä¸€æ ‡è¯†ç¬¦ |
| resource_id | VARCHAR(9) | FOREIGN KEY | å…³è”èµ„æºè¡¨ |
| file_name | VARCHAR(255) | NOT NULL | æ–‡ä»¶åç§°ï¼Œ1-255ä¸ªå­—ç¬¦ |
| file_size | BIGINT | | æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰ |
| file_type | VARCHAR(50) | | æ–‡ä»¶ç±»å‹/MIMEç±»å‹ |
| storage_path | VARCHAR(1000) | | æ–‡ä»¶å­˜å‚¨è·¯å¾„ |
| storage_method | ENUM('local', 'cloud', 'table') | NOT NULL DEFAULT 'local' | æ–‡ä»¶å­˜å‚¨æ–¹å¼ |
| content | LONGTEXT | | æ–‡ä»¶å†…å®¹ï¼ˆç”¨äºæ–‡æœ¬æ–‡ä»¶ï¼‰ |
| download_count | INT | DEFAULT 0 | ä¸‹è½½æ¬¡æ•° |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**æ–‡ä»¶å­˜å‚¨æ¶æ„ï¼š**
- **æœ¬åœ°å­˜å‚¨**: æ–‡ä»¶ä¿å­˜åœ¨Dockerå®¹å™¨çš„æŒä¹…åŒ–å·ä¸­
- **è·¯å¾„ç»„ç»‡**: `/uploads/files/{resource_id}_{filename}.{ext}`
- **ç±»å‹æ”¯æŒ**: æ”¯æŒæ–‡æ¡£ã€å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ç­‰å¤šç§æ–‡ä»¶ç±»å‹
- **å®‰å…¨ä¸‹è½½**: é€šè¿‡JWTè®¤è¯æ§åˆ¶æ–‡ä»¶è®¿é—®æƒé™


---

## 3. å­¦ä¹ ç®¡ç†æ¨¡å—

### 3.1 å­¦ä¹ è®¡åˆ’è¡¨ (study_plans)

ç”¨æˆ·ä¸ªäººå­¦ä¹ è®¡åˆ’ç®¡ç†ï¼Œæ”¯æŒåˆ¶å®šå’Œè·Ÿè¸ªå­¦ä¹ ç›®æ ‡ã€‚

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸæ¡ä»¶ | æè¿° |
|--------|----------|----------|------|
| plan_id | VARCHAR(9) | PRIMARY KEY | 9ä½æ•°å­—çš„è®¡åˆ’å”¯ä¸€æ ‡è¯†ç¬¦ |
| user_phone | VARCHAR(11) | FOREIGN KEY, NOT NULL | ç”¨æˆ·æ‰‹æœºå·ï¼ˆå¤–é”®åˆ°ç”¨æˆ·è¡¨ï¼‰ |
| title | VARCHAR(200) | NOT NULL | è®¡åˆ’æ ‡é¢˜ï¼Œ1-200ä¸ªå­—ç¬¦ |
| description | TEXT | | è®¡åˆ’è¯¦ç»†æè¿° |
| start_date | DATE | NOT NULL | å¼€å§‹æ—¥æœŸ |
| end_date | DATE | NOT NULL | ç»“æŸæ—¥æœŸ |
| status | ENUM('active','completed','paused','cancelled') | DEFAULT 'active' | è®¡åˆ’çŠ¶æ€ï¼šactive-è¿›è¡Œä¸­ï¼Œcompleted-å·²å®Œæˆï¼Œpaused-å·²æš‚åœï¼Œcancelled-å·²å–æ¶ˆ |
| progress_percent | INT | DEFAULT 0 | æ•´ä½“è¿›åº¦ç™¾åˆ†æ¯”ï¼Œ0-100 |
| plan_type | VARCHAR(50) | DEFAULT 'è‡ªå®šä¹‰è®¡åˆ’' | è®¡åˆ’ç±»å‹ï¼ˆå‰ç«¯å¼€å‘ã€ç®—æ³•ç»ƒä¹ ã€è€ƒè¯•å¤ä¹ ç­‰ï¼‰ |
| priority | ENUM('high','medium','low') | DEFAULT 'medium' | ä¼˜å…ˆçº§ |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ä¸šåŠ¡ç‰¹ç‚¹ï¼š**
- æ”¯æŒå¤šç§è®¡åˆ’ç±»å‹ï¼šè‡ªå®šä¹‰è®¡åˆ’ã€å‰ç«¯å¼€å‘ã€åç«¯å¼€å‘ã€ç®—æ³•ç»ƒä¹ ã€è€ƒè¯•å¤ä¹ ã€é¡¹ç›®å®æˆ˜ç­‰
- è‡ªåŠ¨è®¡ç®—æ•´ä½“è¿›åº¦ç™¾åˆ†æ¯”ï¼ŒåŸºäºå…³è”ä»»åŠ¡çš„å®Œæˆæƒ…å†µ
- æ”¯æŒè®¡åˆ’çŠ¶æ€ç®¡ç†ï¼šè¿›è¡Œä¸­ã€å·²å®Œæˆã€å·²æš‚åœã€å·²å–æ¶ˆ
- æä¾›ä¼˜å…ˆçº§ç®¡ç†ï¼Œä¾¿äºç”¨æˆ·è§„åˆ’å­¦ä¹ é‡ç‚¹
- è®¡åˆ’åˆ›å»ºæ—¶è‡ªåŠ¨è®°å½•å­¦ä¹ æ´»åŠ¨å¹¶å¥–åŠ±ç»éªŒå€¼
- æ”¯æŒçµæ´»çš„æ—¶é—´èŒƒå›´è®¾å®šå’Œè¿›åº¦è·Ÿè¸ª

**æ—¶é—´çº¦æŸè§„åˆ™ï¼š**
- **è®¡åˆ’å±‚çº§çº¦æŸ**ï¼šç»“æŸæ—¶é—´ä¸å¾—æ—©äºå½“å‰æ—¶é—´ `end_date >= CURDATE()`
- **æ—¶é—´é€»è¾‘çº¦æŸ**ï¼šç»“æŸæ—¶é—´å¿…é¡»æ™šäºå¼€å§‹æ—¶é—´ `end_date >= start_date`
- **å­ä»»åŠ¡æ—¶é—´çº¦æŸ**ï¼šæ‰€æœ‰å…³è”ä»»åŠ¡çš„æ—¶é—´å¿…é¡»åœ¨è®¡åˆ’æ—¶é—´èŒƒå›´å†…
- **ä¿®æ”¹æ—¶éªŒè¯**ï¼šå˜æ›´è®¡åˆ’æ—¶é—´æ—¶éœ€è¦æ£€æŸ¥æ‰€æœ‰å­ä»»åŠ¡çš„æ—¶é—´åˆæ³•æ€§

### 3.2 å­¦ä¹ ä»»åŠ¡è¡¨ (study_tasks)

å­¦ä¹ è®¡åˆ’ä¸‹çš„å…·ä½“ä»»åŠ¡ç®¡ç†ã€‚

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸæ¡ä»¶ | æè¿° |
|--------|----------|----------|------|
| task_id | VARCHAR(9) | PRIMARY KEY | 9ä½æ•°å­—çš„ä»»åŠ¡å”¯ä¸€æ ‡è¯†ç¬¦ |
| plan_id | VARCHAR(9) | FOREIGN KEY, NOT NULL | å…³è”å­¦ä¹ è®¡åˆ’è¡¨ |
| title | VARCHAR(200) | NOT NULL | ä»»åŠ¡æ ‡é¢˜ |
| description | TEXT | | ä»»åŠ¡æè¿° |
| deadline | DATE | | æˆªæ­¢æ—¥æœŸ |
| priority | ENUM('high','medium','low') | DEFAULT 'medium' | ä»»åŠ¡ä¼˜å…ˆçº§ |
| status | ENUM('pending','in_progress','completed','cancelled') | DEFAULT 'pending' | ä»»åŠ¡çŠ¶æ€ |
| estimated_hours | INT | | é¢„ä¼°å­¦ä¹ æ—¶é•¿ï¼ˆå°æ—¶ï¼‰ |
| actual_hours | INT | DEFAULT 0 | å®é™…å­¦ä¹ æ—¶é•¿ï¼ˆå°æ—¶ï¼‰ |
| tags | VARCHAR(500) | | æ ‡ç­¾ï¼ˆJSONæ ¼å¼å­˜å‚¨ï¼‰ |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ä¸šåŠ¡ç‰¹ç‚¹ï¼š**
- æ”¯æŒå››ç§ä»»åŠ¡çŠ¶æ€ï¼šå¾…å¼€å§‹(pending)ã€è¿›è¡Œä¸­(in_progress)ã€å·²å®Œæˆ(completed)ã€å·²å–æ¶ˆ(cancelled)
- ä»»åŠ¡å®Œæˆæ—¶è‡ªåŠ¨è®°å½•å­¦ä¹ æ´»åŠ¨ï¼Œå¥–åŠ±ç»éªŒå€¼(20åˆ†)
- æ”¯æŒæ ‡ç­¾ç³»ç»Ÿï¼Œä»¥JSONæ ¼å¼å­˜å‚¨ä¾¿äºæœç´¢å’Œåˆ†ç±»
- æä¾›é¢„ä¼°æ—¶é•¿å’Œå®é™…æ—¶é•¿å¯¹æ¯”ï¼Œå¸®åŠ©ç”¨æˆ·æ”¹å–„æ—¶é—´ç®¡ç†
- æ”¯æŒæˆªæ­¢æ—¥æœŸè®¾å®šå’Œé€¾æœŸä»»åŠ¡è¯†åˆ«
- ä»»åŠ¡çŠ¶æ€å˜æ›´æ—¶è‡ªåŠ¨æ›´æ–°æ‰€å±è®¡åˆ’çš„è¿›åº¦ç™¾åˆ†æ¯”
- æ”¯æŒå­ä»»åŠ¡åˆ†è§£ï¼Œä¾¿äºå¤§ä»»åŠ¡çš„ç®¡ç†å’Œè·Ÿè¸ª

**æ—¶é—´çº¦æŸè§„åˆ™ï¼š**
- **ä»»åŠ¡å±‚çº§çº¦æŸ**ï¼šä»»åŠ¡æ—¶é—´å¿…é¡»åœ¨æ‰€å±è®¡åˆ’æ—¶é—´èŒƒå›´å†…
- **å¼€å§‹æ—¶é—´çº¦æŸ**ï¼šä»»åŠ¡å¼€å§‹æ—¶é—´ä¸å¾—æ—©äºè®¡åˆ’å¼€å§‹æ—¶é—´ `task.start_date >= plan.start_date`
- **æˆªæ­¢æ—¶é—´çº¦æŸ**ï¼šä»»åŠ¡æˆªæ­¢æ—¶é—´ä¸å¾—æ™šäºè®¡åˆ’ç»“æŸæ—¶é—´ `task.deadline <= plan.end_date`
- **å­ä»»åŠ¡æ—¶é—´çº¦æŸ**ï¼šæ‰€æœ‰å…³è”å­ä»»åŠ¡çš„æ—¶é—´å¿…é¡»åœ¨ä»»åŠ¡æ—¶é—´èŒƒå›´å†…
- **çº§è”éªŒè¯**ï¼šå˜æ›´ä»»åŠ¡æ—¶é—´æ—¶éœ€è¦éªŒè¯æ‰€æœ‰å­ä»»åŠ¡çš„æ—¶é—´åˆæ³•æ€§

### 3.3 å­ä»»åŠ¡è¡¨ (sub_tasks)

æ”¯æŒä»»åŠ¡çš„ç»†åŒ–åˆ†è§£ï¼Œæä¾›å®Œæ•´çš„äºŒçº§ä»»åŠ¡ç®¡ç†åŠŸèƒ½ã€‚

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸæ¡ä»¶ | æè¿° |
|--------|----------|----------|------|
| subtask_id | INT | PRIMARY KEY, AUTO_INCREMENT | å­ä»»åŠ¡ID |
| task_id | VARCHAR(9) | FOREIGN KEY, NOT NULL | å…³è”å­¦ä¹ ä»»åŠ¡è¡¨ |
| title | VARCHAR(200) | NOT NULL | å­ä»»åŠ¡æ ‡é¢˜ |
| description | TEXT | | å­ä»»åŠ¡è¯¦ç»†æè¿° |
| deadline | DATE | | å­ä»»åŠ¡æˆªæ­¢æ—¥æœŸ |
| priority | ENUM('high','medium','low') | DEFAULT 'medium' | å­ä»»åŠ¡ä¼˜å…ˆçº§ |
| completed | BOOLEAN | DEFAULT FALSE | æ˜¯å¦å·²å®Œæˆ |
| sort_order | INT | DEFAULT 0 | æ’åºé¡ºåº |
| estimated_minutes | INT | | é¢„ä¼°å®Œæˆæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰ |
| notes | TEXT | | å­ä»»åŠ¡å¤‡æ³¨å’Œè¯´æ˜ |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ä¸šåŠ¡ç‰¹ç‚¹ï¼š**
- **å®Œæ•´çš„äºŒçº§ä»»åŠ¡ç®¡ç†**ï¼šæ”¯æŒä»»åŠ¡çš„æ·±åº¦ç»†åŒ–åˆ†è§£ï¼Œæé«˜ä»»åŠ¡ç®¡ç†ç²¾åº¦
- **å±‚çº§åŒ–æ—¶é—´çº¦æŸ**ï¼šå­ä»»åŠ¡æˆªæ­¢æ—¶é—´å¿…é¡»åœ¨çˆ¶ä»»åŠ¡æ—¶é—´èŒƒå›´å†…
- **ä¼˜å…ˆçº§ç®¡ç†**ï¼šæ”¯æŒå­ä»»åŠ¡ä¼˜å…ˆçº§è®¾ç½®ï¼Œå½±å“ä»»åŠ¡è¿›åº¦æƒé‡è®¡ç®—
- **çµæ´»æ’åº**ï¼šæä¾›æ‹–æ‹½æ’åºåŠŸèƒ½ï¼Œä¾¿äºç”¨æˆ·è°ƒæ•´æ‰§è¡Œé¡ºåº
- **è¿›åº¦ä¼ é€’**ï¼šå­ä»»åŠ¡å®ŒæˆçŠ¶æ€è‡ªåŠ¨å½±å“çˆ¶ä»»åŠ¡å’Œè®¡åˆ’çš„æ•´ä½“è¿›åº¦
- **æ—¶é—´ä¼°ç®—**ï¼šæ”¯æŒå­ä»»åŠ¡æ—¶é—´é¢„ä¼°ï¼Œå¸®åŠ©ç”¨æˆ·è¿›è¡Œæ—¶é—´ç®¡ç†
- **è¯¦ç»†è®°å½•**ï¼šæä¾›æè¿°å’Œå¤‡æ³¨å­—æ®µï¼Œæ”¯æŒè¯¦ç»†çš„ä»»åŠ¡è¯´æ˜

**æ—¶é—´çº¦æŸè§„åˆ™ï¼š**
- å­ä»»åŠ¡æˆªæ­¢æ—¶é—´å¿…é¡»åœ¨çˆ¶ä»»åŠ¡çš„æ—¶é—´èŒƒå›´å†…ï¼š`subtask.deadline >= task.start_date AND subtask.deadline <= task.deadline`
- å­ä»»åŠ¡æ—¶é—´å˜æ›´æ—¶éœ€è¦éªŒè¯æ˜¯å¦è¿åå±‚çº§çº¦æŸ
- çˆ¶ä»»åŠ¡æ—¶é—´å˜æ›´æ—¶éœ€è¦æ£€æŸ¥æ‰€æœ‰å­ä»»åŠ¡çš„æ—¶é—´åˆæ³•æ€§

## 4. è®ºå›äº¤æµæ¨¡å—

### 4.1 å¸–å­è¡¨ (posts)

å­˜å‚¨ç”¨æˆ·å‘å¸ƒçš„å¸–å­ä¿¡æ¯ã€‚

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸæ¡ä»¶ | æè¿° |
|--------|----------|----------|------|
| post_id | VARCHAR(9) | PRIMARY KEY | 9ä½æ•°å­—çš„å¸–å­å”¯ä¸€æ ‡è¯†ç¬¦ |
| author_phone | VARCHAR(11) | FOREIGN KEY, NOT NULL | ä½œè€…æ‰‹æœºå·ï¼ˆå¤–é”®åˆ°ç”¨æˆ·è¡¨ï¼‰ |
| title | VARCHAR(200) | NOT NULL | å¸–å­æ ‡é¢˜ï¼Œæœ€å¤š200ä¸ªå­—ç¬¦ |
| content | TEXT | NOT NULL | å¸–å­å†…å®¹ï¼ˆæ”¯æŒMarkdownæ ¼å¼ï¼‰ |
| view_count | INT | DEFAULT 0 | æµè§ˆæ¬¡æ•° |
| comment_count | INT | DEFAULT 0 | è¯„è®ºæ•°é‡ |
| collection_count | INT | DEFAULT 0 | æ”¶è—æ¬¡æ•° |
| report_count | INT | DEFAULT 0 | ä¸¾æŠ¥æ¬¡æ•° |
| status | ENUM('active','hidden','deleted') | DEFAULT 'active' | å¸–å­çŠ¶æ€ |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

### 4.2 å¸–å­æ ‡ç­¾è¡¨ (post_tags)

å­˜å‚¨è®ºå›å¸–å­çš„æ ‡ç­¾ä¿¡æ¯ï¼Œæ”¯æŒåŠ¨æ€æ‰©å±•ã€‚

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸæ¡ä»¶ | æè¿° |
|--------|----------|----------|------|
| tag_id | VARCHAR(9) | PRIMARY KEY | 9ä½æ•°å­—çš„æ ‡ç­¾å”¯ä¸€æ ‡è¯†ç¬¦ |
| tag_name | VARCHAR(50) | UNIQUE, NOT NULL | æ ‡ç­¾åç§°ï¼Œ1-50ä¸ªå­—ç¬¦ |
| tag_color | VARCHAR(7) | DEFAULT '#007aff' | æ ‡ç­¾é¢œè‰²ï¼ˆåå…­è¿›åˆ¶ï¼‰ |
| usage_count | INT | DEFAULT 0 | ä½¿ç”¨æ¬¡æ•°ç»Ÿè®¡ |
| status | ENUM('active','inactive') | DEFAULT 'active' | æ ‡ç­¾çŠ¶æ€ |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

### 4.3 å¸–å­æ ‡ç­¾å…³è”è¡¨ (post_tag_relations)

å®ç°å¸–å­ä¸æ ‡ç­¾çš„å¤šå¯¹å¤šå…³ç³»ã€‚

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸæ¡ä»¶ | æè¿° |
|--------|----------|----------|------|
| relation_id | INT | PRIMARY KEY, AUTO_INCREMENT | å…³è”è®°å½•å”¯ä¸€æ ‡è¯†ç¬¦ |
| post_id | VARCHAR(9) | FOREIGN KEY, NOT NULL | å…³è”å¸–å­è¡¨ |
| tag_id | VARCHAR(9) | FOREIGN KEY, NOT NULL | å…³è”æ ‡ç­¾è¡¨ |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |

### 4.4 è¯„è®ºè¡¨ (comments)

æ”¯æŒå¸–å­å’Œèµ„æºçš„å¤šå±‚çº§å›å¤è¯„è®ºç³»ç»Ÿã€‚

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸæ¡ä»¶ | æè¿° |
|--------|----------|----------|------|
| comment_id | INT | PRIMARY KEY, AUTO_INCREMENT | è¯„è®ºå”¯ä¸€æ ‡è¯†ç¬¦ |
| author_phone | VARCHAR(11) | FOREIGN KEY, NOT NULL | è¯„è®ºä½œè€…æ‰‹æœºå·ï¼ˆå¤–é”®åˆ°ç”¨æˆ·è¡¨ï¼‰ |
| post_id | VARCHAR(9) | FOREIGN KEY | å…³è”å¸–å­IDï¼ˆå¦‚æœæ˜¯å¸–å­è¯„è®ºï¼‰ |
| resource_id | VARCHAR(9) | FOREIGN KEY | å…³è”èµ„æºIDï¼ˆå¦‚æœæ˜¯èµ„æºè¯„è®ºï¼‰ |
| parent_comment_id | INT | FOREIGN KEY | çˆ¶è¯„è®ºIDï¼ˆç”¨äºå›å¤ï¼‰ |
| content | TEXT | NOT NULL | è¯„è®ºå†…å®¹ |
| status | ENUM('active','hidden','deleted') | DEFAULT 'active' | è¯„è®ºçŠ¶æ€ |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

### 4.5 è¯„åˆ†è¡¨ (ratings)

ç”¨æˆ·å¯¹èµ„æºçš„è¯„åˆ†è®°å½•ã€‚

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸæ¡ä»¶ | æè¿° |
|--------|----------|----------|------|
| rating_id | INT | PRIMARY KEY, AUTO_INCREMENT | è¯„åˆ†è®°å½•å”¯ä¸€æ ‡è¯†ç¬¦ |
| user_phone | VARCHAR(11) | FOREIGN KEY, NOT NULL | è¯„åˆ†è€…æ‰‹æœºå·ï¼ˆå¤–é”®ï¼‰ |
| resource_id | VARCHAR(9) | FOREIGN KEY, NOT NULL | å…³è”èµ„æºè¡¨ |
| rating | DECIMAL(3,2) | NOT NULL | è¯„åˆ†ï¼ˆ1-5åˆ†ï¼‰ |
| review_text | TEXT | | è¯„ä»·æ–‡å­—å†…å®¹ |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | è¯„åˆ†æ—¶é—´ |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |


---

## 5. ç”¨æˆ·äº¤äº’æ¨¡å—

### 5.1 ç”¨æˆ·å…³æ³¨è¡¨ (user_follows)

å®ç°ç”¨æˆ·é—´çš„å…³æ³¨å…³ç³»ï¼Œæ”¯æŒå…³æ³¨/å–æ¶ˆå…³æ³¨åŠŸèƒ½ã€‚

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸæ¡ä»¶ | æè¿° |
|--------|----------|----------|------|
| follow_id | VARCHAR(9) | PRIMARY KEY | 9ä½æ•°å­—çš„å…³æ³¨è®°å½•å”¯ä¸€æ ‡è¯†ç¬¦ |
| follower_phone | VARCHAR(11) | FOREIGN KEY, NOT NULL | å…³æ³¨è€…æ‰‹æœºå·ï¼ˆå¤–é”®ï¼‰ |
| following_phone | VARCHAR(11) | FOREIGN KEY, NOT NULL | è¢«å…³æ³¨è€…æ‰‹æœºå·ï¼ˆå¤–é”®ï¼‰ |
| status | ENUM('active','cancelled') | DEFAULT 'active' | å…³æ³¨çŠ¶æ€ï¼šactive-å…³æ³¨ä¸­ï¼Œcancelled-å·²å–æ¶ˆ |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | å…³æ³¨æ—¶é—´ |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ä¸šåŠ¡ç‰¹ç‚¹ï¼š**
- æ”¯æŒç”¨æˆ·äº’ç›¸å…³æ³¨ï¼Œæ„å»ºç¤¾äº¤ç½‘ç»œ
- æä¾›å…³æ³¨åˆ—è¡¨å’Œç²‰ä¸åˆ—è¡¨æŸ¥è¯¢
- å…³æ³¨çŠ¶æ€å¯ä»¥é‡å¤å˜æ›´ï¼ˆå…³æ³¨â†’å–æ¶ˆâ†’é‡æ–°å…³æ³¨ï¼‰
- å»ºç«‹å”¯ä¸€ç´¢å¼•é˜²æ­¢é‡å¤å…³æ³¨è®°å½•

### 5.2 æ”¶è—è¡¨ (collections)

æ”¯æŒå¤šç§å†…å®¹ç±»å‹çš„æ”¶è—åŠŸèƒ½ã€‚

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸæ¡ä»¶ | æè¿° |
|--------|----------|----------|------|
| collection_id | VARCHAR(9) | PRIMARY KEY | 9ä½æ•°å­—çš„æ”¶è—è®°å½•å”¯ä¸€æ ‡è¯†ç¬¦ |
| user_phone | VARCHAR(11) | FOREIGN KEY, NOT NULL | å…³è”ç”¨æˆ·è¡¨ï¼ˆæ”¶è—è€…ï¼‰ |
| content_id | VARCHAR(9) | NOT NULL | è¢«æ”¶è—å†…å®¹çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œ9ä½æ•°å­— |
| collection_type | ENUM('post', 'resource') | NOT NULL | æ”¶è—å†…å®¹ç±»å‹ |
| status | ENUM('active','cancelled') | DEFAULT 'active' | æ”¶è—çŠ¶æ€ |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | æ”¶è—æ—¶é—´ |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

---

## 6. é€šçŸ¥ç³»ç»Ÿæ¨¡å—

### 6.1 é€šçŸ¥è¡¨ (notifications)

ç»Ÿä¸€çš„æ¶ˆæ¯é€šçŸ¥ç®¡ç†ç³»ç»Ÿã€‚

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸæ¡ä»¶ | æè¿° |
|--------|----------|----------|------|
| notification_id | VARCHAR(9) | PRIMARY KEY | 9ä½æ•°å­—çš„é€šçŸ¥å”¯ä¸€æ ‡è¯†ç¬¦ |
| receiver_phone | VARCHAR(11) | FOREIGN KEY, NOT NULL | æ¥æ”¶è€…æ‰‹æœºå· |
| sender_phone | VARCHAR(11) | FOREIGN KEY | å‘é€è€…æ‰‹æœºå·ï¼ˆç³»ç»Ÿé€šçŸ¥å¯ä¸ºç©ºï¼‰ |
| type | ENUM('system','study','interaction','resource','announcement') | NOT NULL | é€šçŸ¥ç±»å‹ |
| priority | ENUM('high','medium','low') | DEFAULT 'medium' | ä¼˜å…ˆçº§ |
| title | VARCHAR(200) | NOT NULL | é€šçŸ¥æ ‡é¢˜ |
| content | TEXT | NOT NULL | é€šçŸ¥å†…å®¹ |
| action_type | ENUM('navigate','external_link','none') | DEFAULT 'none' | æ“ä½œç±»å‹ |
| action_url | VARCHAR(500) | | æ“ä½œé“¾æ¥ |
| is_read | BOOLEAN | DEFAULT FALSE | æ˜¯å¦å·²è¯» |
| read_at | TIMESTAMP | | å·²è¯»æ—¶é—´ |
| expires_at | TIMESTAMP | | è¿‡æœŸæ—¶é—´ |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

---

## 7. ä¸¾æŠ¥ç®¡ç†æ¨¡å—

### 7.1 èµ„æºä¸¾æŠ¥è¡¨ (resource_reports)

å¤„ç†ç”¨æˆ·å¯¹èµ„æºçš„ä¸¾æŠ¥æŠ•è¯‰ã€‚

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸæ¡ä»¶ | æè¿° |
|--------|----------|----------|------|
| report_id | VARCHAR(9) | PRIMARY KEY | 9ä½æ•°å­—çš„ä¸¾æŠ¥è®°å½•å”¯ä¸€æ ‡è¯†ç¬¦ |
| resource_id | VARCHAR(9) | FOREIGN KEY, NOT NULL | è¢«ä¸¾æŠ¥èµ„æºID |
| reporter_phone | VARCHAR(11) | FOREIGN KEY, NOT NULL | ä¸¾æŠ¥è€…æ‰‹æœºå· |
| reason | ENUM('inappropriate','copyright','spam','offensive','other') | NOT NULL | ä¸¾æŠ¥åŸå›  |
| description | TEXT | | è¯¦ç»†æè¿° |
| status | ENUM('pending','processed','rejected') | DEFAULT 'pending' | å¤„ç†çŠ¶æ€ |
| processed_by | VARCHAR(11) | FOREIGN KEY | å¤„ç†äººæ‰‹æœºå· |
| process_result | TEXT | | å¤„ç†ç»“æœè¯´æ˜ |
| processed_at | TIMESTAMP | | å¤„ç†æ—¶é—´ |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ä¸¾æŠ¥åŸå› è¯´æ˜ï¼š**
- **inappropriate**: å†…å®¹ä¸å½“
- **copyright**: ç‰ˆæƒé—®é¢˜
- **spam**: åƒåœ¾ä¿¡æ¯
- **offensive**: æ”»å‡»æ€§å†…å®¹
- **other**: å…¶ä»–åŸå› 

**å¤–é”®å…³ç³»**:
- `resource_id` â†’ `resources.resource_id`
- `reporter_phone` â†’ `users.phone_number`
- `processed_by` â†’ `users.phone_number`

### 7.2 å¸–å­ä¸¾æŠ¥è¡¨ (post_reports)

å¤„ç†ç”¨æˆ·å¯¹å¸–å­çš„ä¸¾æŠ¥æŠ•è¯‰ã€‚

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸæ¡ä»¶ | æè¿° |
|--------|----------|----------|------|
| report_id | VARCHAR(9) | PRIMARY KEY | 9ä½æ•°å­—çš„ä¸¾æŠ¥è®°å½•å”¯ä¸€æ ‡è¯†ç¬¦ |
| post_id | VARCHAR(9) | FOREIGN KEY, NOT NULL | è¢«ä¸¾æŠ¥å¸–å­ID |
| reporter_phone | VARCHAR(11) | FOREIGN KEY, NOT NULL | ä¸¾æŠ¥è€…æ‰‹æœºå· |
| reason | ENUM('inappropriate','spam','offensive','harassment','false_info','other') | NOT NULL | ä¸¾æŠ¥åŸå›  |
| description | TEXT | | è¯¦ç»†æè¿° |
| status | ENUM('pending','processed','rejected') | DEFAULT 'pending' | å¤„ç†çŠ¶æ€ |
| processed_by | VARCHAR(11) | FOREIGN KEY | å¤„ç†äººæ‰‹æœºå· |
| process_result | TEXT | | å¤„ç†ç»“æœè¯´æ˜ |
| processed_at | TIMESTAMP | | å¤„ç†æ—¶é—´ |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ä¸¾æŠ¥åŸå› è¯´æ˜ï¼š**
- **inappropriate**: å†…å®¹ä¸å½“
- **spam**: åƒåœ¾ä¿¡æ¯
- **offensive**: æ”»å‡»æ€§å†…å®¹
- **harassment**: éªšæ‰°è¡Œä¸º
- **false_info**: è™šå‡ä¿¡æ¯
- **other**: å…¶ä»–åŸå› 

**å¤–é”®å…³ç³»**:
- `post_id` â†’ `posts.post_id`
- `reporter_phone` â†’ `users.phone_number`
- `processed_by` â†’ `users.phone_number`

**ä¸¾æŠ¥å¤„ç†æµç¨‹ï¼š**
1. ç”¨æˆ·æäº¤ä¸¾æŠ¥ â†’ `pending` çŠ¶æ€
2. ç®¡ç†å‘˜å®¡æ ¸ä¸¾æŠ¥ â†’ æ›´æ–° `processed_by` å’Œ `process_result`
3. å¤„ç†å®Œæˆ â†’ `processed` çŠ¶æ€ï¼Œè®°å½•å¤„ç†æ—¶é—´
4. è‹¥ä¸¾æŠ¥æ— æ•ˆ â†’ `rejected` çŠ¶æ€

---

## æ•°æ®åº“å…³ç³»è®¾è®¡

### æ ¸å¿ƒå…³ç³»æ¶æ„

#### 1. ç”¨æˆ·ä¸­å¿ƒå…³ç³»ä½“ç³»
- **ç”¨æˆ·è¡¨**ä¸ºæ•´ä¸ªç³»ç»Ÿçš„æ ¸å¿ƒï¼Œä»¥æ‰‹æœºå·ä½œä¸ºä¸»é”®
- ç”¨æˆ·ä¸å…¶ä»–ä¸šåŠ¡å®ä½“å½¢æˆä¸€å¯¹å¤šå…³ç³»ï¼š
  - ç”¨æˆ· â†â†’ èµ„æºå‘å¸ƒï¼ˆ1:Nï¼‰
  - ç”¨æˆ· â†â†’ è®¨è®ºå‘èµ·ï¼ˆ1:Nï¼‰
  - ç”¨æˆ· â†â†’ è¯„è®ºå‘è¡¨ï¼ˆ1:Nï¼‰
  - ç”¨æˆ· â†â†’ å­¦ä¹ è®¡åˆ’ï¼ˆ1:Nï¼‰

#### 2. èµ„æºç®¡ç†å…³ç³»ç½‘ç»œ
```
åˆ†ç±»è¡¨ â†--ä¸€å¯¹å¤š--â†’ èµ„æºè¡¨ â†--ä¸€å¯¹å¤š--â†’ æ–‡ä»¶è¡¨
  â†‘                    â†“
åˆ†ç±»ç®¡ç†            èµ„æºå†…å®¹ç®¡ç†
```

#### 3. å­¦ä¹ ç®¡ç†å…³ç³»ç½‘ç»œ
```
å­¦ä¹ è®¡åˆ’è¡¨ â†--ä¸€å¯¹å¤š--â†’ å­¦ä¹ ä»»åŠ¡è¡¨ â†--ä¸€å¯¹å¤š--â†’ å­ä»»åŠ¡è¡¨
     â†“                    â†“                   â†“
   è¿›åº¦è·Ÿè¸ª             ä»»åŠ¡è¿›åº¦è·Ÿè¸ª        å­ä»»åŠ¡çŠ¶æ€ç®¡ç†
     â†“                    â†“                   â†“
 è‡ªåŠ¨æ›´æ–°              å­¦ä¹ è®°å½•è¡¨          ç»éªŒå€¼ç³»ç»Ÿ
     â†“                    â†“                   â†“
 å±‚çº§åŒ–æ—¶é—´çº¦æŸ        æ—¶é—´çº¦æŸéªŒè¯       æ—¶é—´å†²çªæ£€æµ‹
     â†“
å­¦ä¹ ç›®æ ‡è¡¨ï¼ˆç›®æ ‡è®¾å®šå’Œè¿½è¸ªï¼‰
```

**å±‚çº§åŒ–æ—¶é—´çº¦æŸä½“ç³»ï¼š**
- **è®¡åˆ’çº§çº¦æŸ**: `plan.end_date >= CURDATE()` ä¸” `plan.end_date >= plan.start_date`
- **ä»»åŠ¡çº§çº¦æŸ**: `task.deadline <= plan.end_date` ä¸” `task.start_date >= plan.start_date`
- **å­ä»»åŠ¡çº§çº¦æŸ**: `subtask.deadline <= task.deadline` ä¸” `subtask.deadline >= task.start_date`
- **çº§è”éªŒè¯**: ä¸Šçº§æ—¶é—´å˜æ›´æ—¶è‡ªåŠ¨éªŒè¯ä¸‹çº§æ—¶é—´åˆæ³•æ€§

#### 4. è®ºå›äº¤æµå…³ç³»å±‚æ¬¡
```
å¸–å­è¡¨ â†--å¤šå¯¹å¤š--â†’ å¸–å­æ ‡ç­¾è¡¨ï¼ˆé€šè¿‡post_tag_relationsï¼‰
  â†“
è¯„è®ºè¡¨ï¼ˆæ”¯æŒå±‚çº§å›å¤å…³ç³» parent_comment_idï¼‰
  â†“
èµ„æºè¡¨ â†--ä¸€å¯¹å¤š--â†’ è¯„è®ºè¡¨ï¼ˆèµ„æºè¯„è®ºï¼‰
```

#### 5. ç”¨æˆ·ç¤¾äº¤å…³ç³»ç½‘ç»œ
```
ç”¨æˆ·è¡¨ â†--å¤šå¯¹å¤š--â†’ å…³æ³¨è¡¨ï¼ˆfollower/followeeï¼‰
  â†“
æ”¶è—è¡¨ï¼ˆæ”¯æŒå¤šç§å†…å®¹ç±»å‹æ”¶è—ï¼‰
  â†“
é€šçŸ¥è¡¨ï¼ˆç³»ç»Ÿæ¶ˆæ¯å’Œé€šçŸ¥ï¼‰
```

#### 6. å†…å®¹æ²»ç†å…³ç³»ç½‘ç»œ
```
èµ„æºè¡¨ â†--ä¸€å¯¹å¤š--â†’ èµ„æºä¸¾æŠ¥è¡¨ â†--å¤šå¯¹ä¸€--â†’ ç”¨æˆ·è¡¨ï¼ˆä¸¾æŠ¥è€…ã€å¤„ç†è€…ï¼‰
å¸–å­è¡¨ â†--ä¸€å¯¹å¤š--â†’ å¸–å­ä¸¾æŠ¥è¡¨ â†--å¤šå¯¹ä¸€--â†’ ç”¨æˆ·è¡¨ï¼ˆä¸¾æŠ¥è€…ã€å¤„ç†è€…ï¼‰
  â†“                         â†“
ä¸¾æŠ¥åŸå› åˆ†ç±»            å¤„ç†çŠ¶æ€ç®¡ç†
  â†“                         â†“
ç®¡ç†å‘˜å®¡æ ¸              ä¸¾æŠ¥ç»Ÿè®¡
```

#### 7. ç”¨æˆ·åé¦ˆå…³ç³»ç½‘ç»œ
```
ç”¨æˆ·è¡¨ â†--ä¸€å¯¹å¤š--â†’ ç”¨æˆ·åé¦ˆè¡¨
  â†“                    â†“
åé¦ˆç±»å‹åˆ†ç±»        ç®¡ç†å‘˜å›å¤
  â†“                    â†“
å›¾ç‰‡é™„ä»¶ç®¡ç†        å¤„ç†çŠ¶æ€è·Ÿè¸ª
```

#### 8. ç³»ç»Ÿè¾…åŠ©å…³ç³»ç½‘ç»œ
```
ç”¨æˆ·è¡¨ â†--ä¸€å¯¹å¤š--â†’ éªŒè¯ç è¡¨
  â†“                    â†“
æ‰‹æœºå·éªŒè¯          è¿‡æœŸæ—¶é—´ç®¡ç†
  â†“                    â†“
å®‰å…¨è®¤è¯            å®šæ—¶æ¸…ç†
```

### ä¸šåŠ¡æµç¨‹å…³ç³»

#### èµ„æºåˆ†äº«æµç¨‹
1. ç”¨æˆ·å‘å¸ƒèµ„æº â†’ `resources` è¡¨
2. é€‰æ‹©èµ„æºåˆ†ç±» â†’ `category_id` å­—æ®µå…³è”
3. ä¸Šä¼ ç›¸å…³æ–‡ä»¶ â†’ `files` è¡¨
4. å…¶ä»–ç”¨æˆ·æµè§ˆèµ„æº â†’ æ›´æ–°æµè§ˆç»Ÿè®¡å­—æ®µ

#### å­¦ä¹ ç®¡ç†æµç¨‹
1. **åˆ›å»ºå­¦ä¹ è®¡åˆ’** â†’ `study_plans` è¡¨ï¼ˆè‡ªåŠ¨è®°å½•å­¦ä¹ æ´»åŠ¨ï¼Œå¥–åŠ±15ç»éªŒå€¼ï¼‰
   - æ—¶é—´çº¦æŸéªŒè¯ï¼šç»“æŸæ—¶é—´ >= å½“å‰æ—¶é—´
   - é€»è¾‘çº¦æŸéªŒè¯ï¼šç»“æŸæ—¶é—´ >= å¼€å§‹æ—¶é—´
2. **åˆ¶å®šå­¦ä¹ ä»»åŠ¡** â†’ `study_tasks` è¡¨
   - å±‚çº§çº¦æŸéªŒè¯ï¼šä»»åŠ¡æ—¶é—´å¿…é¡»åœ¨è®¡åˆ’æ—¶é—´èŒƒå›´å†…
   - æ”¯æŒå¤šä¸ªä»»åŠ¡å¹¶è¡Œç®¡ç†
3. **åˆ†è§£å­ä»»åŠ¡** â†’ `sub_tasks` è¡¨ï¼ˆå¯é€‰ï¼Œæ”¯æŒå¤æ‚ä»»åŠ¡ç®¡ç†ï¼‰
   - å­ä»»åŠ¡æ—¶é—´çº¦æŸï¼šå¿…é¡»åœ¨çˆ¶ä»»åŠ¡æ—¶é—´èŒƒå›´å†…
   - æ”¯æŒä¼˜å…ˆçº§å’Œæ—¶é—´ä¼°ç®—è®¾ç½®
4. **å®Œæˆä»»åŠ¡/å­ä»»åŠ¡** â†’ çŠ¶æ€æ›´æ–°ï¼ˆè‡ªåŠ¨è®°å½•å­¦ä¹ æ´»åŠ¨ï¼Œå¥–åŠ±ç»éªŒå€¼ï¼‰
   - å­ä»»åŠ¡å®Œæˆ â†’ å½±å“ä»»åŠ¡è¿›åº¦è®¡ç®—
   - ä»»åŠ¡å®Œæˆ â†’ å½±å“è®¡åˆ’è¿›åº¦è®¡ç®—
5. **è‡ªåŠ¨æ›´æ–°è®¡åˆ’è¿›åº¦** â†’ åŸºäºä»»åŠ¡å’Œå­ä»»åŠ¡å®Œæˆæƒ…å†µå®æ—¶è®¡ç®—
   - æ”¯æŒåŠ æƒè¿›åº¦è®¡ç®—ï¼ˆåŸºäºä¼˜å…ˆçº§ï¼‰
   - å®æ—¶åŒæ­¥åˆ°å‰ç«¯ç•Œé¢
6. **å­¦ä¹ è½¨è¿¹è¿½è¸ª** â†’ `study_records` è¡¨è®°å½•æ‰€æœ‰å­¦ä¹ æ´»åŠ¨
   - è¯¦ç»†è®°å½•æ—¶é—´æŠ•å…¥å’Œç»éªŒè·å¾—
   - æ”¯æŒå­¦ä¹ æ•ˆç‡åˆ†æ

#### è®ºå›äº¤æµæµç¨‹
1. ç”¨æˆ·å‘å¸ƒå¸–å­ â†’ `posts` è¡¨
2. å…³è”å¸–å­æ ‡ç­¾ â†’ `post_tag_relations` è¡¨
3. å…¶ä»–ç”¨æˆ·è¯„è®º â†’ `comments` è¡¨
4. å±‚çº§å›å¤æœºåˆ¶ â†’ `parent_comment_id` å­—æ®µ

---

## æŠ€æœ¯å®ç°è§„èŒƒ

### æ•°æ®ç±»å‹è§„èŒƒ
- **ä¸»é”®ç­–ç•¥**ï¼šç”¨æˆ·è¡¨ä½¿ç”¨ä¸šåŠ¡ä¸»é”®ï¼ˆæ‰‹æœºå·ï¼‰ï¼Œå…¶ä»–è¡¨ä½¿ç”¨è‡ªå¢IDæˆ–ä¸šåŠ¡ID
- **å¤–é”®çº¦æŸ**ï¼šæ‰€æœ‰å¤–é”®å…³ç³»ä½¿ç”¨CASCADEåˆ é™¤æˆ–RESTRICTçº¦æŸ
- **æ—¶é—´æˆ³ç®¡ç†**ï¼šç»Ÿä¸€ä½¿ç”¨TIMESTAMPç±»å‹ï¼Œè‡ªåŠ¨ç»´æŠ¤åˆ›å»ºå’Œæ›´æ–°æ—¶é—´
- **çŠ¶æ€ç®¡ç†**ï¼šä½¿ç”¨ENUMç±»å‹ç¡®ä¿çŠ¶æ€å€¼çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§
- **å­—ç¬¦ç¼–ç **ï¼šå…¨åº“ä½¿ç”¨UTF-8ç¼–ç ï¼Œæ”¯æŒemojiå’Œå¤šè¯­è¨€

### ä¸šåŠ¡IDè®¾è®¡è§„èŒƒ
- **ç”¨æˆ·æ ‡è¯†**ï¼š11ä½æ‰‹æœºå·ï¼ˆä¸šåŠ¡æ„ä¹‰æ˜ç¡®ï¼‰
- **å­¦å·¥å·æ ¼å¼**ï¼š8ä½æ•°å­—æˆ–S+9ä½æ•°å­—ï¼ˆæ”¯æŒå­¦ç”Ÿå’Œæ•™å¸ˆï¼‰
- **ä¸šåŠ¡IDæ ¼å¼**ï¼š9ä½æ•°å­—å­—ç¬¦ä¸²ï¼ˆèµ„æºã€æ´»åŠ¨ã€è®¨è®ºç­‰ï¼‰
- **è‡ªå¢ID**ï¼šç”¨äºå…³è”è¡¨å’Œç»Ÿè®¡è¡¨

### ç´¢å¼•ä¼˜åŒ–ç­–ç•¥
- **ä¸»é”®ç´¢å¼•**ï¼šè‡ªåŠ¨åˆ›å»ºï¼Œæ— éœ€é¢å¤–é…ç½®
- **å¤–é”®ç´¢å¼•**ï¼šè‡ªåŠ¨åˆ›å»ºï¼Œæ”¯æŒå…³è”æŸ¥è¯¢ä¼˜åŒ–
- **ä¸šåŠ¡ç´¢å¼•**ï¼šä¸ºé«˜é¢‘æŸ¥è¯¢å­—æ®µåˆ›å»ºå¤åˆç´¢å¼•
- **å”¯ä¸€çº¦æŸ**ï¼šç¡®ä¿æ•°æ®å”¯ä¸€æ€§ï¼Œè‡ªåŠ¨åˆ›å»ºå”¯ä¸€ç´¢å¼•

### æ•°æ®å®Œæ•´æ€§ä¿éšœ
- **çº§è”åˆ é™¤**ï¼šç”¨æˆ·åˆ é™¤æ—¶çº§è”åˆ é™¤ç›¸å…³æ•°æ®
- **çŠ¶æ€ä¸€è‡´æ€§**ï¼šä½¿ç”¨ENUMç±»å‹çº¦æŸçŠ¶æ€å­—æ®µ
- **éç©ºçº¦æŸ**ï¼šå…³é”®ä¸šåŠ¡å­—æ®µè®¾ç½®NOT NULL
- **é•¿åº¦é™åˆ¶**ï¼šåˆç†è®¾ç½®å­—ç¬¦ä¸²å­—æ®µé•¿åº¦ä¸Šé™

---

## æ•°æ®åº“é€‰å‹å»ºè®®

### æ¨èé…ç½®
- **æ•°æ®åº“å¼•æ“**ï¼šMySQL 8.0+ æˆ– PostgreSQL 13+
- **å­˜å‚¨å¼•æ“**ï¼šInnoDBï¼ˆæ”¯æŒäº‹åŠ¡å’Œå¤–é”®çº¦æŸï¼‰
- **å­—ç¬¦é›†**ï¼šutf8mb4ï¼ˆæ”¯æŒemojiå’Œç‰¹æ®Šå­—ç¬¦ï¼‰
- **æ’åºè§„åˆ™**ï¼šutf8mb4_unicode_ci

### æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ
- **è¯»å†™åˆ†ç¦»**ï¼šä¸»ä»å¤åˆ¶ï¼Œè¯»è¯·æ±‚åˆ†å‘åˆ°ä»åº“
- **åˆ†åº“åˆ†è¡¨**ï¼šç”¨æˆ·æ•°æ®æŒ‰æ‰‹æœºå·hashåˆ†ç‰‡
- **ç¼“å­˜ç­–ç•¥**ï¼šçƒ­ç‚¹æ•°æ®ä½¿ç”¨Redisç¼“å­˜
- **ç´¢å¼•ä¼˜åŒ–**ï¼šå®šæœŸåˆ†ææŸ¥è¯¢æ¨¡å¼ï¼Œä¼˜åŒ–ç´¢å¼•ç»“æ„

### è¿ç»´ç®¡ç†ç­–ç•¥
- **å¤‡ä»½ç­–ç•¥**ï¼šæ¯æ—¥å…¨é‡å¤‡ä»½+å®æ—¶å¢é‡å¤‡ä»½
- **ç›‘æ§å‘Šè­¦**ï¼šæ•°æ®åº“æ€§èƒ½æŒ‡æ ‡ç›‘æ§
- **å®¹é‡è§„åˆ’**ï¼šé¢„ä¼°æ•°æ®å¢é•¿ï¼Œæå‰æ‰©å®¹
- **å®‰å…¨é˜²æŠ¤**ï¼šæ•°æ®åŠ å¯†ã€è®¿é—®æ§åˆ¶ã€å®¡è®¡æ—¥å¿—

---

## æ‰©å±•æ€§è®¾è®¡

### æ°´å¹³æ‰©å±•æ”¯æŒ
- ç”¨æˆ·è¡¨æ”¯æŒæŒ‰æ‰‹æœºå·åˆ†ç‰‡
- ä¸šåŠ¡è¡¨æ”¯æŒæŒ‰ç”¨æˆ·ç»´åº¦åˆ†ç‰‡
- è·¨åˆ†ç‰‡æŸ¥è¯¢é€šè¿‡ä¸­é—´ä»¶å¤„ç†

### åŠŸèƒ½æ¨¡å—æ‰©å±•
- ç±»å‹è¡¨è®¾è®¡æ”¯æŒåŠ¨æ€æ·»åŠ æ–°åˆ†ç±»
- é€šçŸ¥ç³»ç»Ÿæ”¯æŒå¤šç§é€šçŸ¥ç±»å‹æ‰©å±•
- æ–‡ä»¶å­˜å‚¨æ”¯æŒå¤šç§å­˜å‚¨æ–¹å¼

### æ•°æ®è¿ç§»æ–¹æ¡ˆ
- ç‰ˆæœ¬åŒ–æ•°æ®åº“è„šæœ¬ç®¡ç†
- æ”¯æŒå¹³æ»‘çš„ç»“æ„å˜æ›´
- æ•°æ®è¿ç§»å·¥å…·å’Œå›æ»šæœºåˆ¶

## æ•°æ®åº“è®¾è®¡æ€»ç»“

æœ¬æ•°æ®åº“è®¾è®¡å……åˆ†è€ƒè™‘äº†æ•™è‚²èµ„æºå¹³å°çš„ä¸šåŠ¡ç‰¹ç‚¹ï¼Œæ„å»ºäº†å®Œæ•´çš„å­¦ä¹ ç”Ÿæ€ç³»ç»Ÿï¼š

### ğŸ¯ æ ¸å¿ƒè®¾è®¡äº®ç‚¹

1. **å®Œæ•´çš„å­¦ä¹ ç®¡ç†ä½“ç³»**
   - ä¸‰çº§å­¦ä¹ ç®¡ç†ï¼šè®¡åˆ’â†’ä»»åŠ¡â†’å­ä»»åŠ¡
   - å±‚çº§åŒ–æ—¶é—´çº¦æŸéªŒè¯ç³»ç»Ÿ
   - æ™ºèƒ½è¿›åº¦è®¡ç®—å’Œç»éªŒå€¼å¥–åŠ±

2. **å…¨é¢çš„å†…å®¹æ²»ç†æœºåˆ¶**
   - èµ„æºå®¡æ ¸æµç¨‹ï¼ˆdraftâ†’pendingâ†’published/rejectedï¼‰
   - ç”¨æˆ·ä¸¾æŠ¥ç³»ç»Ÿï¼ˆèµ„æº+å¸–å­ï¼‰
   - ç®¡ç†å‘˜å¤„ç†å·¥ä½œæµ

3. **ä¸°å¯Œçš„ç”¨æˆ·äº¤äº’åŠŸèƒ½**
   - å¤šç»´åº¦ç¤¾äº¤ç³»ç»Ÿï¼ˆå…³æ³¨ã€æ”¶è—ã€è¯„è®ºã€è¯„åˆ†ï¼‰
   - åˆ†ç±»é€šçŸ¥ç³»ç»Ÿï¼ˆç³»ç»Ÿã€å­¦ä¹ ã€äº’åŠ¨ç­‰ï¼‰
   - ç”¨æˆ·åé¦ˆå»ºè®®æœºåˆ¶

4. **å¥å£®çš„ç³»ç»Ÿæ¶æ„**
   - åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ï¼ˆuser/adminï¼‰
   - å®Œå–„çš„æ•°æ®å®Œæ•´æ€§çº¦æŸ
   - ä¼˜åŒ–çš„ç´¢å¼•å’ŒæŸ¥è¯¢æ€§èƒ½

### ğŸ“Š æ•°æ®è§„æ¨¡è¯´æ˜

- **24ä¸ªæ ¸å¿ƒè¡¨**ï¼Œè¦†ç›–å®Œæ•´ä¸šåŠ¡æµç¨‹
- **æ”¯æŒç™¾ä¸‡çº§ç”¨æˆ·**å’Œæµ·é‡å­¦ä¹ æ•°æ®
- **æ¨¡å—åŒ–è®¾è®¡**ï¼Œä¾¿äºåŠŸèƒ½æ‰©å±•å’Œç»´æŠ¤
- **æ ‡å‡†åŒ–å­—æ®µ**ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§

### ğŸ”§ æŠ€æœ¯ç‰¹è‰²

- **ä¸šåŠ¡IDè®¾è®¡**ï¼šæ‰‹æœºå·+9ä½æ•°å­—IDä½“ç³»
- **è½¯åˆ é™¤æœºåˆ¶**ï¼šçŠ¶æ€ç®¡ç†è€Œéç‰©ç†åˆ é™¤
- **æ—¶é—´çº¦æŸç³»ç»Ÿ**ï¼šå¤šå±‚çº§æ—¶é—´éªŒè¯
- **ç»Ÿè®¡å­—æ®µå†—ä½™**ï¼šæå‡æŸ¥è¯¢æ€§èƒ½

### ğŸš€ æ‰©å±•æ”¯æŒ

è¯¥è®¾è®¡æ”¯æŒç”¨æˆ·çš„å®Œæ•´å­¦ä¹ ç”Ÿæ€ç³»ç»Ÿï¼Œä»èµ„æºè·å–åˆ°å­¦ä¹ è®¡åˆ’ç®¡ç†ï¼Œå†åˆ°ç¤¾åŒºäº’åŠ¨äº¤æµå’Œç³»ç»Ÿåé¦ˆï¼Œä¸ºç”¨æˆ·æä¾›ä¸€ç«™å¼çš„å­¦ä¹ æœåŠ¡ä½“éªŒã€‚æ•°æ®åº“è®¾è®¡å…·å¤‡è‰¯å¥½çš„æ‰©å±•æ€§ï¼Œå¯æ”¯æŒæœªæ¥åŠŸèƒ½è¿­ä»£å’Œç³»ç»Ÿå‡çº§éœ€æ±‚ã€‚

---

## ä¸ªäººä¸­å¿ƒåŠŸèƒ½å®ç°æ¦‚è¿°

### å·²å®ç°åŠŸèƒ½æ¨¡å—

âœ… **ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯**
- èµ„æºå‘å¸ƒæ•°é‡ç»Ÿè®¡ (`resources` è¡¨)
- å¸–å­å‘å¸ƒæ•°é‡ç»Ÿè®¡ (`posts` è¡¨)
- å…³æ³¨å’Œç²‰ä¸æ•°é‡ç»Ÿè®¡ (`user_follows` è¡¨)
- æ”¶è—æ•°é‡ç»Ÿè®¡ (`collections` è¡¨)

âœ… **æˆ‘çš„èµ„æºç®¡ç†**
- èµ„æºåˆ—è¡¨å±•ç¤ºï¼ˆæ”¯æŒçŠ¶æ€ç­›é€‰ï¼špublished/pending/rejectedï¼‰
- èµ„æºè¯¦æƒ…æŸ¥çœ‹å’Œç¼–è¾‘
- èµ„æºçŠ¶æ€ç®¡ç†å’Œå®¡æ ¸æµç¨‹
- æ–‡ä»¶å…³è”å’Œä¸‹è½½ç»Ÿè®¡

âœ… **æˆ‘çš„å¸–å­ç®¡ç†**
- å¸–å­åˆ—è¡¨å±•ç¤ºï¼ˆæ”¯æŒçŠ¶æ€ç­›é€‰ï¼šactive/hidden/deletedï¼‰
- å¸–å­å†…å®¹ç®¡ç†å’Œç¼–è¾‘
- è¯„è®ºæ•°é‡å’Œæµè§ˆç»Ÿè®¡
- å¸–å­æ ‡ç­¾å…³è”

âœ… **å…³æ³¨/ç²‰ä¸ç®¡ç†**
- æˆ‘çš„å…³æ³¨åˆ—è¡¨ (`user_follows` è¡¨ï¼Œfollower_phone æŸ¥è¯¢ï¼‰
- æˆ‘çš„ç²‰ä¸åˆ—è¡¨ (`user_follows` è¡¨ï¼Œfollowing_phone æŸ¥è¯¢ï¼‰
- å…³æ³¨/å–æ¶ˆå…³æ³¨æ“ä½œï¼ˆçŠ¶æ€åˆ‡æ¢ï¼šactive/cancelledï¼‰
- åŒå‘å…³æ³¨æ£€æŸ¥å’Œå›å…³åŠŸèƒ½

âœ… **æ”¶è—ç®¡ç†**
- å¤šç±»å‹æ”¶è—æ”¯æŒï¼ˆresource/post é€šè¿‡ `collection_type` åŒºåˆ†ï¼‰
- æ”¶è—åˆ—è¡¨å±•ç¤ºå’Œç­›é€‰
- å–æ¶ˆæ”¶è—æ“ä½œï¼ˆçŠ¶æ€ç®¡ç†ï¼šactive/cancelledï¼‰
- æ”¶è—å†…å®¹è¯¦æƒ…å…³è”

### APIæ¥å£è®¾è®¡

#### ç”¨æˆ·ç»Ÿè®¡æ¥å£
```http
GET /api/v1/users/stats
Authorization: Bearer {token}
```
**è¿”å›æ•°æ®**: resourceCount, postCount, followingCount, followerCount, collectionCount

#### èµ„æºç®¡ç†æ¥å£
```http
GET /api/v1/users/my-resources?status={status}&page={page}&limit={limit}
Authorization: Bearer {token}
```
**æ”¯æŒçŠ¶æ€**: published, pending, rejected
**è¿”å›æ•°æ®**: ç”¨æˆ·å‘å¸ƒçš„èµ„æºåˆ—è¡¨ï¼ŒåŒ…å«æ–‡ä»¶ä¿¡æ¯å’Œç»Ÿè®¡æ•°æ®

#### å¸–å­ç®¡ç†æ¥å£
```http
GET /api/v1/users/my-posts?status={status}&page={page}&limit={limit}
Authorization: Bearer {token}
```
**æ”¯æŒçŠ¶æ€**: active, hidden, deleted
**è¿”å›æ•°æ®**: ç”¨æˆ·å‘å¸ƒçš„å¸–å­åˆ—è¡¨ï¼ŒåŒ…å«æ ‡ç­¾å’Œç»Ÿè®¡ä¿¡æ¯

#### å…³æ³¨ç®¡ç†æ¥å£
```http
GET /api/v1/users/following?page={page}&limit={limit}    # è·å–å…³æ³¨åˆ—è¡¨
GET /api/v1/users/followers?page={page}&limit={limit}    # è·å–ç²‰ä¸åˆ—è¡¨
POST /api/v1/users/follow/{phone}                        # å…³æ³¨/å–æ¶ˆå…³æ³¨åˆ‡æ¢
Authorization: Bearer {token}
```

#### æ”¶è—ç®¡ç†æ¥å£
```http
GET /api/v1/users/my-collections?collection_type={type}&page={page}&limit={limit}
DELETE /api/v1/collections/{content_id}?collection_type={type}
Authorization: Bearer {token}
```
**æ”¯æŒç±»å‹**: resource, post

### æ•°æ®åº“è¡¨ç»“æ„ä¼˜åŒ–

#### å…³é”®ç´¢å¼•è®¾è®¡
```sql
-- ç”¨æˆ·ç»Ÿè®¡æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_resources_publisher_status ON resources(publisher_phone, status);
CREATE INDEX idx_posts_author_status ON posts(author_phone, status);
CREATE INDEX idx_collections_user_status ON collections(user_phone, status);
CREATE INDEX idx_user_follows_status ON user_follows(follower_phone, following_phone, status);

-- åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_resources_created_at ON resources(created_at DESC);
CREATE INDEX idx_posts_created_at ON posts(created_at DESC);
CREATE INDEX idx_collections_created_at ON collections(created_at DESC);
```

#### æ•°æ®å®Œæ•´æ€§çº¦æŸ
- **å”¯ä¸€çº¦æŸ**: user_follows è¡¨é˜²æ­¢é‡å¤å…³æ³¨ `UNIQUE(follower_phone, following_phone)`
- **å”¯ä¸€çº¦æŸ**: collections è¡¨é˜²æ­¢é‡å¤æ”¶è— `UNIQUE(user_phone, content_id, collection_type)`
- **å¤–é”®çº¦æŸ**: æ‰€æœ‰å…³è”è¡¨è®¾ç½®çº§è”åˆ é™¤æˆ– SET NULL
- **çŠ¶æ€æšä¸¾**: ä½¿ç”¨ ENUM ç±»å‹ç¡®ä¿çŠ¶æ€å€¼ä¸€è‡´æ€§

### ä¸šåŠ¡é€»è¾‘å®ç°

#### å…³æ³¨ç³»ç»Ÿè®¾è®¡
- **å…³æ³¨æ“ä½œ**: åˆ›å»ºæˆ–æ›´æ–° user_follows è®°å½•ï¼ŒçŠ¶æ€ä¸º 'active'
- **å–æ¶ˆå…³æ³¨**: æ›´æ–° status ä¸º 'cancelled'ï¼ˆè½¯åˆ é™¤ï¼Œä¿ç•™å†å²è®°å½•ï¼‰
- **é‡æ–°å…³æ³¨**: å°†å·²å–æ¶ˆçš„å…³æ³¨è®°å½•çŠ¶æ€æ”¹å› 'active'
- **äº’å…³æ£€æŸ¥**: æŸ¥è¯¢åŒå‘å…³æ³¨è®°å½•åˆ¤æ–­æ˜¯å¦ä¸ºäº’ç›¸å…³æ³¨

#### æ”¶è—ç³»ç»Ÿè®¾è®¡
- **å¤šç±»å‹æ”¯æŒ**: é€šè¿‡ collection_type åŒºåˆ†èµ„æºæ”¶è—å’Œå¸–å­æ”¶è—
- **å†…å®¹å…³è”**: content_id å­—æ®µå­˜å‚¨è¢«æ”¶è—å†…å®¹çš„ä¸»é”®
- **çŠ¶æ€ç®¡ç†**: active/cancelled çŠ¶æ€å®ç°è½¯åˆ é™¤æœºåˆ¶
- **æ•°æ®åŒæ­¥**: æ”¶è—æ•°å˜åŒ–æ—¶æ›´æ–°å¯¹åº”èµ„æºæˆ–å¸–å­çš„ç»Ÿè®¡å­—æ®µ

#### ç»Ÿè®¡æ•°æ®ç»´æŠ¤
- **å®æ—¶ç»Ÿè®¡**: é€šè¿‡ COUNT æŸ¥è¯¢å®æ—¶è®¡ç®—ç»Ÿè®¡æ•°æ®
- **ç¼“å­˜ç­–ç•¥**: å¯åœ¨ Redis ä¸­ç¼“å­˜é¢‘ç¹æŸ¥è¯¢çš„ç»Ÿè®¡æ•°æ®
- **å®šæ—¶æ›´æ–°**: å¯è®¾ç½®å®šæ—¶ä»»åŠ¡åŒæ­¥ç»Ÿè®¡æ•°æ®åˆ°ä¸»è¡¨å­—æ®µ

### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### æŸ¥è¯¢ä¼˜åŒ–
- **åˆ†é¡µæŸ¥è¯¢**: ä½¿ç”¨ LIMIT/OFFSET å®ç°åˆ†é¡µï¼Œé¿å…å¤§æ•°æ®é‡æŸ¥è¯¢
- **çŠ¶æ€ç­›é€‰**: åˆ©ç”¨çŠ¶æ€å­—æ®µç´¢å¼•å¿«é€Ÿç­›é€‰æ•°æ®
- **å…³è”æŸ¥è¯¢**: é€‚å½“ä½¿ç”¨ JOIN å‡å°‘ N+1 æŸ¥è¯¢é—®é¢˜

#### æ•°æ®åŒæ­¥ä¼˜åŒ–
- **æ‰¹é‡æ“ä½œ**: æ‰¹é‡å–æ¶ˆæ”¶è—ç­‰æ“ä½œä½¿ç”¨äº‹åŠ¡ä¿è¯ä¸€è‡´æ€§
- **å¼‚æ­¥å¤„ç†**: ç»Ÿè®¡æ•°æ®æ›´æ–°å¯å¼‚æ­¥å¤„ç†ï¼Œé¿å…é˜»å¡ä¸»æµç¨‹
- **è¯»å†™åˆ†ç¦»**: ç»Ÿè®¡æŸ¥è¯¢å¯åˆ†å‘åˆ°åªè¯»å®ä¾‹

ä¸ªäººä¸­å¿ƒåŠŸèƒ½é€šè¿‡å®Œå–„çš„æ•°æ®åº“è®¾è®¡å’Œ API æ¥å£ï¼Œä¸ºç”¨æˆ·æä¾›äº†å®Œæ•´çš„ä¸ªäººæ•°æ®ç®¡ç†åŠŸèƒ½ï¼Œæ”¯æŒèµ„æºç®¡ç†ã€ç¤¾äº¤äº’åŠ¨ã€å†…å®¹æ”¶è—ç­‰æ ¸å¿ƒéœ€æ±‚ï¼Œå…·å¤‡è‰¯å¥½çš„æ‰©å±•æ€§å’Œæ€§èƒ½è¡¨ç°ã€‚

---

## 8. ä¸¾æŠ¥ç®¡ç†æ¨¡å—

ä¸¾æŠ¥ç®¡ç†æ¨¡å—æä¾›äº†å®Œæ•´çš„ç”¨æˆ·ä¸¾æŠ¥å’Œç®¡ç†å‘˜å®¡æ ¸åŠŸèƒ½ï¼Œæ”¯æŒå¯¹ä¸å½“èµ„æºå’Œå¸–å­å†…å®¹çš„ä¸¾æŠ¥å¤„ç†æµç¨‹ã€‚

### 8.1 èµ„æºä¸¾æŠ¥è¡¨ (resource_reports)

ç”¨æˆ·å¯¹èµ„æºå†…å®¹è¿›è¡Œä¸¾æŠ¥çš„è®°å½•è¡¨ï¼Œæ”¯æŒå¤šç§ä¸¾æŠ¥åŸå› å’Œå®Œæ•´çš„å¤„ç†æµç¨‹ã€‚

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸæ¡ä»¶ | æè¿° |
|--------|----------|----------|------|
| report_id | VARCHAR(9) | PRIMARY KEY | ä¸¾æŠ¥è®°å½•IDï¼Œ9ä½æ•°å­—ï¼ˆä»¥7å¼€å¤´ï¼‰ |
| resource_id | VARCHAR(9) | NOT NULL | è¢«ä¸¾æŠ¥èµ„æºIDï¼ˆå¤–é”®ï¼‰ |
| reporter_phone | VARCHAR(11) | NOT NULL | ä¸¾æŠ¥è€…æ‰‹æœºå·ï¼ˆå¤–é”®ï¼‰ |
| reason | ENUM | NOT NULL | ä¸¾æŠ¥åŸå› ï¼šinappropriate, copyright, spam, offensive, other |
| description | TEXT | | è¯¦ç»†æè¿° |
| status | ENUM | DEFAULT 'pending' | å¤„ç†çŠ¶æ€ï¼špending-å¾…å¤„ç†ï¼Œprocessed-å·²å¤„ç†ï¼Œrejected-å·²é©³å› |
| processed_by | VARCHAR(11) | | å¤„ç†äººæ‰‹æœºå·ï¼ˆå¤–é”®ï¼‰ |
| process_result | TEXT | | å¤„ç†ç»“æœè¯´æ˜ |
| processed_at | TIMESTAMP | | å¤„ç†æ—¶é—´ |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ä¸¾æŠ¥åŸå› è¯´æ˜**:
- **inappropriate**: å†…å®¹ä¸å½“
- **copyright**: ç‰ˆæƒé—®é¢˜
- **spam**: åƒåœ¾ä¿¡æ¯
- **offensive**: å†’çŠ¯æ€§å†…å®¹
- **other**: å…¶ä»–

**å¤–é”®å…³ç³»**:
- `resource_id` â†’ `resources.resource_id`
- `reporter_phone` â†’ `users.phone_number`
- `processed_by` â†’ `users.phone_number`

### 8.2 å¸–å­ä¸¾æŠ¥è¡¨ (post_reports)

ç”¨æˆ·å¯¹å¸–å­å†…å®¹è¿›è¡Œä¸¾æŠ¥çš„è®°å½•è¡¨ï¼Œæ”¯æŒé’ˆå¯¹è®ºå›å†…å®¹çš„ä¸¾æŠ¥ç®¡ç†ã€‚

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸæ¡ä»¶ | æè¿° |
|--------|----------|----------|------|
| report_id | VARCHAR(9) | PRIMARY KEY | ä¸¾æŠ¥è®°å½•IDï¼Œ9ä½æ•°å­—ï¼ˆä»¥7å¼€å¤´ï¼‰ |
| post_id | VARCHAR(9) | NOT NULL | è¢«ä¸¾æŠ¥å¸–å­IDï¼ˆå¤–é”®ï¼‰ |
| reporter_phone | VARCHAR(11) | NOT NULL | ä¸¾æŠ¥è€…æ‰‹æœºå·ï¼ˆå¤–é”®ï¼‰ |
| reason | ENUM | NOT NULL | ä¸¾æŠ¥åŸå› ï¼šinappropriate, spam, offensive, harassment, false_info, other |
| description | TEXT | | è¯¦ç»†æè¿° |
| status | ENUM | DEFAULT 'pending' | å¤„ç†çŠ¶æ€ï¼špending-å¾…å¤„ç†ï¼Œprocessed-å·²å¤„ç†ï¼Œrejected-å·²é©³å› |
| processed_by | VARCHAR(11) | | å¤„ç†äººæ‰‹æœºå·ï¼ˆå¤–é”®ï¼‰ |
| process_result | TEXT | | å¤„ç†ç»“æœè¯´æ˜ |
| processed_at | TIMESTAMP | | å¤„ç†æ—¶é—´ |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**å¸–å­ä¸¾æŠ¥åŸå› è¯´æ˜**:
- **inappropriate**: å†…å®¹ä¸å½“
- **spam**: åƒåœ¾ä¿¡æ¯
- **offensive**: å†’çŠ¯æ€§å†…å®¹
- **harassment**: éªšæ‰°ä»–äºº
- **false_info**: è™šå‡ä¿¡æ¯
- **other**: å…¶ä»–

**å¤–é”®å…³ç³»**:
- `post_id` â†’ `posts.post_id`
- `reporter_phone` â†’ `users.phone_number`
- `processed_by` â†’ `users.phone_number`

**ä¸¾æŠ¥å¤„ç†æµç¨‹**:
1. ç”¨æˆ·æäº¤ä¸¾æŠ¥ â†’ `pending` çŠ¶æ€
2. ç®¡ç†å‘˜å®¡æ ¸ä¸¾æŠ¥ â†’ æ›´æ–° `processed_by` å’Œ `process_result`
3. å¤„ç†å®Œæˆ â†’ `processed` çŠ¶æ€ï¼Œè®°å½•å¤„ç†æ—¶é—´
4. è‹¥ä¸¾æŠ¥æ— æ•ˆ â†’ `rejected` çŠ¶æ€

---

## 9. ç”¨æˆ·åé¦ˆæ¨¡å—

### 9.1 ç”¨æˆ·åé¦ˆè¡¨ (feedbacks)

ç”¨æˆ·å‘ç®¡ç†å‘˜æäº¤ç³»ç»Ÿåé¦ˆå’Œå»ºè®®çš„è®°å½•è¡¨ï¼Œæ”¯æŒå¤šç§åé¦ˆç±»å‹å’Œå¤„ç†æµç¨‹ã€‚

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸæ¡ä»¶ | æè¿° |
|--------|----------|----------|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | åé¦ˆè®°å½•ID |
| user_phone | VARCHAR(11) | FOREIGN KEY, NOT NULL | ç”¨æˆ·æ‰‹æœºå·ï¼ˆå¤–é”®ï¼‰ |
| type | VARCHAR(32) | NOT NULL | åé¦ˆç±»å‹ï¼šbug/feature/ui/performance/content/other |
| content | TEXT | NOT NULL | åé¦ˆå†…å®¹è¯¦æƒ… |
| contact | VARCHAR(64) | | ç”¨æˆ·è”ç³»æ–¹å¼ï¼ˆå¯é€‰ï¼‰ |
| images | TEXT | | å›¾ç‰‡URLæ•°ç»„ï¼ŒJSONå­—ç¬¦ä¸²æ ¼å¼ |
| status | VARCHAR(16) | DEFAULT 'pending' | å¤„ç†çŠ¶æ€ï¼špending-å¾…å¤„ç†ï¼Œprocessing-å¤„ç†ä¸­ï¼Œresolved-å·²è§£å†³ï¼Œclosed-å·²å…³é—­ |
| reply | TEXT | | ç®¡ç†å‘˜å›å¤å†…å®¹ |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**åé¦ˆç±»å‹è¯´æ˜**:
- **bug**: ç³»ç»Ÿé”™è¯¯åé¦ˆ
- **feature**: åŠŸèƒ½å»ºè®®
- **ui**: ç•Œé¢è®¾è®¡é—®é¢˜
- **performance**: æ€§èƒ½é—®é¢˜
- **content**: å†…å®¹ç›¸å…³é—®é¢˜
- **other**: å…¶ä»–ç±»å‹åé¦ˆ

**å¤„ç†çŠ¶æ€æµç¨‹**:
1. **pending**: ç”¨æˆ·æäº¤åçš„åˆå§‹çŠ¶æ€
2. **processing**: ç®¡ç†å‘˜å¼€å§‹å¤„ç†
3. **resolved**: é—®é¢˜å·²è§£å†³ï¼Œç­‰å¾…ç”¨æˆ·ç¡®è®¤
4. **closed**: åé¦ˆå·²å…³é—­ï¼ˆé—®é¢˜è§£å†³æˆ–æ— æ•ˆåé¦ˆï¼‰

**å¤–é”®å…³ç³»**:
- `user_phone` â†’ `users.phone_number`

### 9.2 åé¦ˆç®¡ç†åŠŸèƒ½

#### ç”¨æˆ·åé¦ˆæäº¤
- æ”¯æŒå¤šç§åé¦ˆç±»å‹é€‰æ‹©
- å¯é€‰æ‹©ä¸Šä¼ ç›¸å…³æˆªå›¾ï¼ˆæœ€å¤š3å¼ ï¼‰
- å¯ç•™ä¸‹è”ç³»æ–¹å¼ä¾¿äºè·Ÿè¿›
- æ”¯æŒåŒ¿ååé¦ˆï¼ˆä¸å¼ºåˆ¶ç™»å½•ï¼‰

#### ç®¡ç†å‘˜å¤„ç†æµç¨‹
1. **æŸ¥çœ‹åé¦ˆåˆ—è¡¨**: æŒ‰çŠ¶æ€ã€ç±»å‹ã€æ—¶é—´ç­›é€‰
2. **è¯¦ç»†å®¡æ ¸**: æŸ¥çœ‹åé¦ˆå†…å®¹ã€å›¾ç‰‡å’Œç”¨æˆ·ä¿¡æ¯
3. **å›å¤ç”¨æˆ·**: æä¾›è§£å†³æ–¹æ¡ˆæˆ–å¤„ç†è¿›åº¦
4. **çŠ¶æ€æ›´æ–°**: æ ¹æ®å¤„ç†è¿›åº¦æ›´æ–°çŠ¶æ€
5. **æ‰¹é‡æ“ä½œ**: æ”¯æŒæ‰¹é‡å…³é—­ã€åˆ†ç±»å¤„ç†

#### APIæ¥å£è®¾è®¡
```http
# ç”¨æˆ·æäº¤åé¦ˆ
POST /api/v1/feedback
Authorization: Bearer {token} (å¯é€‰)
Content-Type: application/json
{
  "type": "bug",
  "content": "åé¦ˆå†…å®¹",
  "contact": "è”ç³»æ–¹å¼",
  "images": ["image1.jpg", "image2.jpg"]
}

# ç”¨æˆ·æŸ¥çœ‹è‡ªå·±çš„åé¦ˆ
GET /api/v1/feedback/my?status={status}&page={page}&limit={limit}
Authorization: Bearer {token}

# ç®¡ç†å‘˜æŸ¥çœ‹æ‰€æœ‰åé¦ˆ
GET /api/v1/admin/feedback?type={type}&status={status}&page={page}&limit={limit}
Authorization: Bearer {admin_token}

# ç®¡ç†å‘˜å›å¤åé¦ˆ
POST /api/v1/admin/feedback/{id}/reply
Authorization: Bearer {admin_token}
Content-Type: application/json
{
  "reply": "å›å¤å†…å®¹",
  "status": "resolved"
}
```

---

## 10. ç³»ç»Ÿè¾…åŠ©æ¨¡å—

### 10.1 éªŒè¯ç è¡¨ (verification_codes)

ç”¨äºçŸ­ä¿¡éªŒè¯ç å’Œé‚®ç®±éªŒè¯ç çš„ä¸´æ—¶å­˜å‚¨å’ŒéªŒè¯ã€‚

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸæ¡ä»¶ | æè¿° |
|--------|----------|----------|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | éªŒè¯ç è®°å½•ID |
| phone_number | VARCHAR(11) | NOT NULL | æ‰‹æœºå· |
| code | VARCHAR(6) | NOT NULL | 6ä½æ•°å­—éªŒè¯ç  |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |
| expires_at | TIMESTAMP | NOT NULL | è¿‡æœŸæ—¶é—´ |
| status | ENUM('valid','used','expired') | DEFAULT 'valid' | éªŒè¯ç çŠ¶æ€ |

**ä¸šåŠ¡ç‰¹ç‚¹**:
- **å®‰å…¨æ€§**: 6ä½éšæœºæ•°å­—ç ï¼Œ5åˆ†é’Ÿæœ‰æ•ˆæœŸ
- **é¢‘ç‡é™åˆ¶**: åŒä¸€æ‰‹æœºå·60ç§’å†…åªèƒ½å‘é€ä¸€æ¬¡
- **çŠ¶æ€ç®¡ç†**: valid-æœ‰æ•ˆï¼Œused-å·²ä½¿ç”¨ï¼Œexpired-å·²è¿‡æœŸ
- **è‡ªåŠ¨æ¸…ç†**: å®šæ—¶æ¸…ç†è¿‡æœŸçš„éªŒè¯ç è®°å½•

**éªŒè¯æµç¨‹**:
1. **å‘é€éªŒè¯ç **: ç”Ÿæˆéšæœº6ä½æ•°å­—ï¼Œè®¾ç½®5åˆ†é’Ÿè¿‡æœŸæ—¶é—´
2. **éªŒè¯ç æ ¡éªŒ**: æ£€æŸ¥æ‰‹æœºå·ã€éªŒè¯ç ã€æœ‰æ•ˆæœŸå’ŒçŠ¶æ€
3. **ä½¿ç”¨åæ ‡è®°**: éªŒè¯æˆåŠŸåå°†çŠ¶æ€æ›´æ”¹ä¸º'used'
4. **å®šæ—¶æ¸…ç†**: æ¯æ—¥æ¸…ç†è¿‡æœŸå’Œå·²ä½¿ç”¨çš„éªŒè¯ç 

#### APIæ¥å£è®¾è®¡
```http
# å‘é€éªŒè¯ç 
POST /api/v1/auth/send-code
Content-Type: application/json
{
  "phone_number": "13800138000"
}

# éªŒè¯éªŒè¯ç 
POST /api/v1/auth/verify-code
Content-Type: application/json
{
  "phone_number": "13800138000",
  "code": "123456"
}
```

### 10.2 ç´¢å¼•ä¼˜åŒ–å»ºè®®

#### åé¦ˆè¡¨ä¼˜åŒ–
```sql
-- åé¦ˆçŠ¶æ€æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_feedbacks_status_created ON feedbacks(status, created_at DESC);
CREATE INDEX idx_feedbacks_user_status ON feedbacks(user_phone, status);
CREATE INDEX idx_feedbacks_type_status ON feedbacks(type, status);
```

#### éªŒè¯ç è¡¨ä¼˜åŒ–
```sql
-- éªŒè¯ç æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_verification_phone_status ON verification_codes(phone_number, status, expires_at);
CREATE INDEX idx_verification_expires ON verification_codes(expires_at);
CREATE INDEX idx_verification_created ON verification_codes(created_at);
```

---

## å­¦ä¹ ç®¡ç†æ¨¡å—å¢å¼ºè®¾è®¡

### å­ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ

#### APIè®¾è®¡è§„èŒƒ

**å­ä»»åŠ¡ç®¡ç†æ¥å£**
```http
# è·å–ä»»åŠ¡çš„æ‰€æœ‰å­ä»»åŠ¡
GET /api/v1/study-plans/tasks/{taskId}/subtasks
Authorization: Bearer {token}

# åˆ›å»ºå­ä»»åŠ¡
POST /api/v1/study-plans/tasks/{taskId}/subtasks
Authorization: Bearer {token}
Content-Type: application/json
{
  "title": "å­ä»»åŠ¡æ ‡é¢˜",
  "description": "å­ä»»åŠ¡æè¿°",
  "deadline": "2024-12-31",
  "priority": "medium",
  "estimated_minutes": 120,
  "notes": "å¤‡æ³¨ä¿¡æ¯"
}

# æ›´æ–°å­ä»»åŠ¡
PUT /api/v1/study-plans/subtasks/{subtaskId}
Authorization: Bearer {token}
Content-Type: application/json

# æ‰¹é‡æ›´æ–°å­ä»»åŠ¡æ’åº
PATCH /api/v1/study-plans/tasks/{taskId}/subtasks/reorder
Authorization: Bearer {token}
Content-Type: application/json
{
  "subtasks": [
    {"subtask_id": 1, "sort_order": 1},
    {"subtask_id": 2, "sort_order": 2}
  ]
}

# åˆ‡æ¢å­ä»»åŠ¡å®ŒæˆçŠ¶æ€
PATCH /api/v1/study-plans/subtasks/{subtaskId}/toggle
Authorization: Bearer {token}

# åˆ é™¤å­ä»»åŠ¡
DELETE /api/v1/study-plans/subtasks/{subtaskId}
Authorization: Bearer {token}
```

#### æ—¶é—´çº¦æŸéªŒè¯ç³»ç»Ÿ

**éªŒè¯å±‚çº§æ¶æ„**
```javascript
// 1. å‰ç«¯å®æ—¶éªŒè¯
function validateSubtaskTime(subtask, parentTask) {
  if (subtask.deadline > parentTask.deadline) {
    return { valid: false, message: 'å­ä»»åŠ¡æˆªæ­¢æ—¶é—´ä¸èƒ½æ™šäºä»»åŠ¡æˆªæ­¢æ—¶é—´' }
  }
  if (subtask.deadline < parentTask.start_date) {
    return { valid: false, message: 'å­ä»»åŠ¡æˆªæ­¢æ—¶é—´ä¸èƒ½æ—©äºä»»åŠ¡å¼€å§‹æ—¶é—´' }
  }
  return { valid: true }
}

// 2. åç«¯APIéªŒè¯
async function validateTimeConstraints(req, res, next) {
  const { taskId, deadline } = req.body
  const task = await StudyTask.findByPk(taskId)
  const plan = await StudyPlan.findByPk(task.plan_id)
  
  // å±‚çº§åŒ–éªŒè¯
  if (deadline > task.deadline || deadline < task.start_date) {
    return res.status(400).json({
      success: false,
      message: 'å­ä»»åŠ¡æ—¶é—´ä¸åœ¨ä»»åŠ¡æ—¶é—´èŒƒå›´å†…'
    })
  }
  
  next()
}

// 3. æ•°æ®åº“çº¦æŸ
ALTER TABLE sub_tasks 
ADD CONSTRAINT check_deadline_range 
CHECK (deadline IS NULL OR (
  deadline >= (SELECT start_date FROM study_tasks 
               WHERE task_id = sub_tasks.task_id) AND
  deadline <= (SELECT deadline FROM study_tasks 
               WHERE task_id = sub_tasks.task_id)
))
```

#### è¿›åº¦è®¡ç®—ç®—æ³•ä¼˜åŒ–

**åŠ æƒè¿›åº¦è®¡ç®—**
```javascript
// å­ä»»åŠ¡è¿›åº¦å½±å“ä»»åŠ¡è¿›åº¦
function calculateTaskProgress(task) {
  const subtasks = task.subtasks || []
  if (subtasks.length === 0) {
    return task.status === 'completed' ? 100 : 0
  }
  
  // åŸºäºä¼˜å…ˆçº§çš„åŠ æƒè®¡ç®—
  const weights = { high: 3, medium: 2, low: 1 }
  let totalWeight = 0
  let completedWeight = 0
  
  subtasks.forEach(subtask => {
    const weight = weights[subtask.priority] || 1
    totalWeight += weight
    if (subtask.completed) {
      completedWeight += weight
    }
  })
  
  return totalWeight > 0 ? Math.round((completedWeight / totalWeight) * 100) : 0
}

// ä»»åŠ¡è¿›åº¦å½±å“è®¡åˆ’è¿›åº¦
function calculatePlanProgress(plan) {
  const tasks = plan.tasks || []
  if (tasks.length === 0) return 0
  
  let totalWeight = 0
  let weightedProgress = 0
  
  tasks.forEach(task => {
    const weight = getTaskWeight(task.priority)
    const taskProgress = calculateTaskProgress(task)
    totalWeight += weight
    weightedProgress += (taskProgress * weight)
  })
  
  return totalWeight > 0 ? Math.round(weightedProgress / totalWeight) : 0
}
```

### ä¸šåŠ¡è§„åˆ™æ€»ç»“

#### æ—¶é—´çº¦æŸå±‚çº§
1. **è®¡åˆ’çº§åˆ«**ï¼šend_date >= CURDATE()ï¼ˆä¸¥æ ¼çº¦æŸï¼‰
2. **ä»»åŠ¡çº§åˆ«**ï¼šæ—¶é—´èŒƒå›´å¿…é¡»åœ¨è®¡åˆ’æ—¶é—´å†…ï¼ˆèŒƒå›´çº¦æŸï¼‰
3. **å­ä»»åŠ¡çº§åˆ«**ï¼šæ—¶é—´èŒƒå›´å¿…é¡»åœ¨ä»»åŠ¡æ—¶é—´å†…ï¼ˆèŒƒå›´çº¦æŸï¼‰

#### æ•°æ®ä¸€è‡´æ€§ä¿éšœ
- ä¸Šçº§æ—¶é—´å˜æ›´æ—¶çº§è”éªŒè¯ä¸‹çº§æ—¶é—´
- åˆ é™¤æ“ä½œçš„çº§è”å¤„ç†ï¼ˆCASCADEï¼‰
- çŠ¶æ€å˜æ›´çš„è‡ªåŠ¨è¿›åº¦æ›´æ–°
- å¹¶å‘æ“ä½œçš„äº‹åŠ¡ä¿æŠ¤

#### ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- å®æ—¶çš„æ—¶é—´çº¦æŸæç¤º
- æ™ºèƒ½çš„é»˜è®¤æ—¶é—´æ¨è
- æ‰¹é‡æ“ä½œçš„åŸå­æ€§ä¿è¯
- é”™è¯¯ä¿¡æ¯çš„å‹å¥½å±•ç¤º

